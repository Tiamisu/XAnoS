
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>ASAXS_widget &#8212; SAXS_Drive 0.11 documentation</title>
    <link rel="stylesheet" href="../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="nav-item nav-item-0"><a href="../index.html">SAXS_Drive 0.11 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for ASAXS_widget</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">PyQt5.QtWidgets</span> <span class="k">import</span> <span class="n">QWidget</span><span class="p">,</span> <span class="n">QApplication</span><span class="p">,</span> <span class="n">QPushButton</span><span class="p">,</span> <span class="n">QLabel</span><span class="p">,</span> <span class="n">QLineEdit</span><span class="p">,</span> <span class="n">QVBoxLayout</span><span class="p">,</span> <span class="n">QMessageBox</span><span class="p">,</span> <span class="n">QCheckBox</span><span class="p">,</span> <span class="n">QSpinBox</span><span class="p">,</span> <span class="n">QComboBox</span><span class="p">,</span> <span class="n">QListWidget</span><span class="p">,</span> <span class="n">QDialog</span><span class="p">,</span> <span class="n">QFileDialog</span><span class="p">,</span> <span class="n">QProgressBar</span><span class="p">,</span> <span class="n">QTableWidget</span><span class="p">,</span> <span class="n">QTableWidgetItem</span><span class="p">,</span> <span class="n">QAbstractItemView</span><span class="p">,</span> <span class="n">QSpinBox</span><span class="p">,</span> <span class="n">QShortcut</span><span class="p">,</span> <span class="n">QSplitter</span><span class="p">,</span> <span class="n">QProgressDialog</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtGui</span> <span class="k">import</span> <span class="n">QPalette</span><span class="p">,</span> <span class="n">QKeySequence</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtCore</span> <span class="k">import</span> <span class="n">Qt</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">pyqtgraph</span> <span class="k">as</span> <span class="nn">pg</span>
<span class="kn">from</span> <span class="nn">pyqtgraph.dockarea</span> <span class="k">import</span> <span class="n">DockArea</span><span class="p">,</span> <span class="n">Dock</span>
<span class="kn">from</span> <span class="nn">xraydb</span> <span class="k">import</span> <span class="n">XrayDB</span>
<span class="kn">from</span> <span class="nn">PlotWidget</span> <span class="k">import</span> <span class="n">PlotWidget</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy</span> <span class="k">as</span> <span class="nn">sp</span>
<span class="kn">from</span> <span class="nn">scipy.signal</span> <span class="k">import</span> <span class="n">fftconvolve</span><span class="p">,</span> <span class="n">savgol_filter</span>
<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="k">import</span> <span class="n">interp1d</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="k">import</span> <span class="n">minimize</span>
<span class="kn">from</span> <span class="nn">numpy.linalg</span> <span class="k">import</span> <span class="n">lstsq</span><span class="p">,</span> <span class="n">solve</span>
<span class="kn">from</span> <span class="nn">lmfit</span> <span class="k">import</span> <span class="n">Parameters</span>
<span class="kn">from</span> <span class="nn">lmfit</span> <span class="k">import</span> <span class="n">minimize</span> <span class="k">as</span> <span class="n">lmfit_minimize</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">calc_cf</span> <span class="k">import</span> <span class="n">calc_cf</span>
<span class="kn">from</span> <span class="nn">utils</span> <span class="k">import</span> <span class="n">calc_prm</span>
<span class="kn">from</span> <span class="nn">readData</span> <span class="k">import</span> <span class="n">read1DSAXS</span>
<span class="kn">import</span> <span class="nn">periodictable</span> <span class="k">as</span> <span class="nn">pdt</span>

<div class="viewcode-block" id="ASAXS_Widget"><a class="viewcode-back" href="../SAXS_Drive_link.html#ASAXS_widget.ASAXS_Widget">[docs]</a><span class="k">class</span> <span class="nc">ASAXS_Widget</span><span class="p">(</span><span class="n">QWidget</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This widget class is developed to perform to decouple various scattering contributions of ASAXS data. The contributions include</span>
<span class="sd">    1) Non resonant scattering term</span>
<span class="sd">    2) Cross term</span>
<span class="sd">    3) Resonant term</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">QWidget</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xrdb</span><span class="o">=</span><span class="n">XrayDB</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cwd</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataDir</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cwd</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">=</span><span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xrf_bkg</span><span class="o">=</span><span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">energyLines</span><span class="o">=</span><span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ffactors</span><span class="o">=</span><span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fCounter</span><span class="o">=</span><span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xrf_base</span><span class="o">=</span><span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">minEnergy</span><span class="o">=</span><span class="mf">1000000.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metaKeys</span><span class="o">=</span><span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CF</span><span class="o">=</span><span class="mf">1.0</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">vblayout</span><span class="o">=</span><span class="n">QVBoxLayout</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mainDock</span><span class="o">=</span><span class="n">DockArea</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vblayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mainDock</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">dataDock</span><span class="o">=</span><span class="n">Dock</span><span class="p">(</span><span class="s1">&#39;Data Dock&#39;</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataPlotDock</span><span class="o">=</span><span class="n">Dock</span><span class="p">(</span><span class="s1">&#39;Data Plot&#39;</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metaDataPlotDock</span><span class="o">=</span><span class="n">Dock</span><span class="p">(</span><span class="s1">&#39;Metadata Plot&#39;</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edgePlotDock</span><span class="o">=</span><span class="n">Dock</span><span class="p">(</span><span class="s1">&#39;Edge Plot&#39;</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ASAXSCheckPlotDock</span><span class="o">=</span><span class="n">Dock</span><span class="p">(</span><span class="s1">&#39;ASAXS Check Plot&#39;</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ASAXSPlotDock</span><span class="o">=</span><span class="n">Dock</span><span class="p">(</span><span class="s1">&#39;ASAXS components&#39;</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mainDock</span><span class="o">.</span><span class="n">addDock</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataDock</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mainDock</span><span class="o">.</span><span class="n">addDock</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataPlotDock</span><span class="p">,</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mainDock</span><span class="o">.</span><span class="n">addDock</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metaDataPlotDock</span><span class="p">,</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mainDock</span><span class="o">.</span><span class="n">addDock</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edgePlotDock</span><span class="p">,</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mainDock</span><span class="o">.</span><span class="n">addDock</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ASAXSCheckPlotDock</span><span class="p">,</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mainDock</span><span class="o">.</span><span class="n">addDock</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ASAXSPlotDock</span><span class="p">,</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mainDock</span><span class="o">.</span><span class="n">moveDock</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ASAXSCheckPlotDock</span><span class="p">,</span><span class="s1">&#39;above&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ASAXSPlotDock</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mainDock</span><span class="o">.</span><span class="n">moveDock</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edgePlotDock</span><span class="p">,</span><span class="s1">&#39;above&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ASAXSCheckPlotDock</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mainDock</span><span class="o">.</span><span class="n">moveDock</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metaDataPlotDock</span><span class="p">,</span><span class="s1">&#39;above&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">edgePlotDock</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mainDock</span><span class="o">.</span><span class="n">moveDock</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataPlotDock</span><span class="p">,</span><span class="s1">&#39;above&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">metaDataPlotDock</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">create_dataDock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_dataPlotDock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_metaDataPlotDock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_edgePlotDock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_ASAXSCheckPlotDock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_ASAXSPlotDock</span><span class="p">()</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">edgeEnergy</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elementEdgeComboBox</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lstrip</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EminLineEdit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%.4f</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="mf">0.9</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">edgeEnergy</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EmaxLineEdit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%.4f</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="mf">1.1</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">edgeEnergy</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_edgePlot</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initialize_metaDataPlotDock</span><span class="p">()</span>
        
        
        
<div class="viewcode-block" id="ASAXS_Widget.create_dataDock"><a class="viewcode-back" href="../SAXS_Drive_link.html#ASAXS_widget.ASAXS_Widget.create_dataDock">[docs]</a>    <span class="k">def</span> <span class="nf">create_dataDock</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This dock is to hold the information about the resonant element of interest and a list of data </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataDockLayout</span><span class="o">=</span><span class="n">pg</span><span class="o">.</span><span class="n">LayoutWidget</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">row</span><span class="o">=</span><span class="mi">0</span>
        <span class="n">col</span><span class="o">=</span><span class="mi">0</span>
        <span class="n">dataBaseLabel</span><span class="o">=</span><span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;Xray database&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xrayDataBaseComboBox</span><span class="o">=</span><span class="n">QComboBox</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataDockLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">dataBaseLabel</span><span class="p">,</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
        <span class="n">col</span><span class="o">+=</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xrayDataBaseComboBox</span><span class="o">.</span><span class="n">addItems</span><span class="p">([</span><span class="s1">&#39;NIST&#39;</span><span class="p">,</span><span class="s1">&#39;Henke&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataBase</span><span class="o">=</span><span class="s1">&#39;NIST&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xrayDataBaseComboBox</span><span class="o">.</span><span class="n">currentIndexChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataBaseChanged</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataDockLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xrayDataBaseComboBox</span><span class="p">,</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">,</span><span class="n">colspan</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        
        <span class="n">row</span><span class="o">+=</span><span class="mi">1</span>
        <span class="n">col</span><span class="o">=</span><span class="mi">0</span>        
        <span class="n">elementLabel</span><span class="o">=</span><span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;Resonant Element&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elementComboBox</span><span class="o">=</span><span class="n">QComboBox</span><span class="p">()</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">xrdb</span><span class="o">.</span><span class="n">atomic_symbols</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elementComboBox</span><span class="o">.</span><span class="n">addItems</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xrdb</span><span class="o">.</span><span class="n">atomic_number</span><span class="p">(</span><span class="n">element</span><span class="p">))</span><span class="o">+</span><span class="s1">&#39;: &#39;</span><span class="o">+</span><span class="n">element</span> <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elementComboBox</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="mi">37</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataDockLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">elementLabel</span><span class="p">,</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
        <span class="n">col</span><span class="o">+=</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataDockLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elementComboBox</span><span class="p">,</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">,</span><span class="n">colspan</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        
        <span class="n">row</span><span class="o">+=</span><span class="mi">1</span>
        <span class="n">col</span><span class="o">=</span><span class="mi">0</span>
        <span class="n">elementEdge</span><span class="o">=</span><span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;Energy Edge (keV)&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elementEdgeComboBox</span><span class="o">=</span><span class="n">QComboBox</span><span class="p">()</span>
        <span class="n">element</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elementComboBox</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;: &#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">edges</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">xrdb</span><span class="o">.</span><span class="n">xray_edges</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elementEdgeComboBox</span><span class="o">.</span><span class="n">addItems</span><span class="p">([</span><span class="n">key</span><span class="o">+</span><span class="s1">&#39;: </span><span class="si">%.4f</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">edges</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">edge</span><span class="o">/</span><span class="mi">1000</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">edges</span><span class="o">.</span><span class="n">keys</span><span class="p">()])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataDockLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">elementEdge</span><span class="p">,</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
        <span class="n">col</span><span class="o">+=</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataDockLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elementEdgeComboBox</span><span class="p">,</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">,</span><span class="n">colspan</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elementComboBox</span><span class="o">.</span><span class="n">currentIndexChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elementChanged</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elementEdgeComboBox</span><span class="o">.</span><span class="n">currentIndexChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edgeChanged</span><span class="p">)</span>
        
        <span class="n">row</span><span class="o">+=</span><span class="mi">1</span>
        <span class="n">col</span><span class="o">=</span><span class="mi">0</span>
        <span class="n">EOffLabel</span><span class="o">=</span><span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;Energy offset (keV)&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EOffLineEdit</span><span class="o">=</span><span class="n">QLineEdit</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%.4f</span><span class="s1">&#39;</span><span class="o">%</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EOffLineEdit</span><span class="o">.</span><span class="n">returnPressed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataSelectionChanged</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataDockLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">EOffLabel</span><span class="p">,</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
        <span class="n">col</span><span class="o">+=</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataDockLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">EOffLineEdit</span><span class="p">,</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">,</span><span class="n">colspan</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        
        <span class="n">row</span><span class="o">+=</span><span class="mi">1</span>
        <span class="n">col</span><span class="o">=</span><span class="mi">0</span>
        <span class="n">delELabel</span><span class="o">=</span><span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;Energy resolution (keV)&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delELineEdit</span><span class="o">=</span><span class="n">QLineEdit</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%.4f</span><span class="s1">&#39;</span><span class="o">%</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delELineEdit</span><span class="o">.</span><span class="n">returnPressed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataSelectionChanged</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataDockLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">delELabel</span><span class="p">,</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
        <span class="n">col</span><span class="o">+=</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataDockLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">delELineEdit</span><span class="p">,</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">,</span><span class="n">colspan</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        
        <span class="n">row</span><span class="o">+=</span><span class="mi">1</span>
        <span class="n">col</span><span class="o">=</span><span class="mi">0</span>
        <span class="n">linearOffsetLabel</span><span class="o">=</span><span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;Linear offset&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataDockLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">linearOffsetLabel</span><span class="p">,</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
        <span class="n">col</span><span class="o">+=</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">linearOffsetLineEdit</span><span class="o">=</span><span class="n">QLineEdit</span><span class="p">(</span><span class="s1">&#39;0.0&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">linearOffsetLineEdit</span><span class="o">.</span><span class="n">returnPressed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataSelectionChanged</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataDockLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">linearOffsetLineEdit</span><span class="p">,</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">,</span><span class="n">colspan</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>        
        
        <span class="n">row</span><span class="o">+=</span><span class="mi">1</span>
        <span class="n">col</span><span class="o">=</span><span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xrfBkgCheckBox</span><span class="o">=</span><span class="n">QCheckBox</span><span class="p">(</span><span class="s1">&#39;XRF-Bkg Q-range (%)&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xrfBkgCheckBox</span><span class="o">.</span><span class="n">setTristate</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xrfBkgCheckBox</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xrfBkgCheckBox</span><span class="o">.</span><span class="n">stateChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataSelectionChanged</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xrfBkgRangeLineEdit</span><span class="o">=</span><span class="n">QLineEdit</span><span class="p">(</span><span class="s1">&#39;95:100&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xrfBkgRangeLineEdit</span><span class="o">.</span><span class="n">returnPressed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataSelectionChanged</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xrfBkgRangeLineEdit</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataDockLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xrfBkgCheckBox</span><span class="p">,</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
        <span class="n">col</span><span class="o">+=</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataDockLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xrfBkgRangeLineEdit</span><span class="p">,</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">,</span><span class="n">colspan</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>        
        
        <span class="n">row</span><span class="o">+=</span><span class="mi">1</span>
        <span class="n">col</span><span class="o">=</span><span class="mi">0</span>
        <span class="n">XRFLabel</span><span class="o">=</span><span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;XRF Baseline&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataDockLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">XRFLabel</span><span class="p">,</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
        <span class="n">col</span><span class="o">+=</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xrfBkgLineEdit</span><span class="o">=</span><span class="n">QLineEdit</span><span class="p">(</span><span class="s1">&#39;0.0&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataDockLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xrfBkgLineEdit</span><span class="p">,</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
        <span class="n">col</span><span class="o">+=</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xrfBkgCalcPushButton</span><span class="o">=</span><span class="n">QPushButton</span><span class="p">(</span><span class="s1">&#39;Calc XRF-Bkg&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xrfBkgCalcPushButton</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">calc_XRF_baseline</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataDockLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xrfBkgCalcPushButton</span><span class="p">,</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
        
        
        <span class="n">row</span><span class="o">+=</span><span class="mi">1</span>
        <span class="n">col</span><span class="o">=</span><span class="mi">0</span>
        <span class="n">dataLabel</span><span class="o">=</span><span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;Data files&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataDockLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">dataLabel</span><span class="p">,</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">openDataPushButton</span><span class="o">=</span><span class="n">QPushButton</span><span class="p">(</span><span class="s1">&#39;Import data&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">openDataPushButton</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">import_data</span><span class="p">)</span>
        <span class="n">col</span><span class="o">+=</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataDockLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">openDataPushButton</span><span class="p">,</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">,</span><span class="n">colspan</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        
        
        <span class="n">row</span><span class="o">+=</span><span class="mi">1</span>
        <span class="n">col</span><span class="o">=</span><span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataListWidget</span><span class="o">=</span><span class="n">QListWidget</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataListWidget</span><span class="o">.</span><span class="n">setSelectionMode</span><span class="p">(</span><span class="n">QAbstractItemView</span><span class="o">.</span><span class="n">ExtendedSelection</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataListWidget</span><span class="o">.</span><span class="n">itemSelectionChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataSelectionChanged</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataDockLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataListWidget</span><span class="p">,</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">,</span><span class="n">rowspan</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">colspan</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        
        <span class="n">row</span><span class="o">+=</span><span class="mi">10</span>
        <span class="n">col</span><span class="o">=</span><span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">removeDataPushButton</span><span class="o">=</span><span class="n">QPushButton</span><span class="p">(</span><span class="s1">&#39;Remove selected Data&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">removeDataPushButton</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">remove_data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deleteShortCut</span><span class="o">=</span><span class="n">QShortcut</span><span class="p">(</span><span class="n">QKeySequence</span><span class="o">.</span><span class="n">Delete</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deleteShortCut</span><span class="o">.</span><span class="n">activated</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">remove_data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataDockLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">removeDataPushButton</span><span class="p">,</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
        <span class="n">col</span><span class="o">+=</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">batchProcessorPushButton</span><span class="o">=</span><span class="n">QPushButton</span><span class="p">(</span><span class="s1">&#39;Open Batch Processor&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataDockLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">batchProcessorPushButton</span><span class="p">,</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">,</span><span class="n">colspan</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">batchProcessorPushButton</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">batchProcess</span><span class="p">)</span>
        
        <span class="n">row</span><span class="o">+=</span><span class="mi">1</span>
        <span class="n">col</span><span class="o">=</span><span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bkgScaleLineEdit</span><span class="o">=</span><span class="n">QLineEdit</span><span class="p">(</span><span class="s1">&#39;1.0&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataDockLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bkgScaleLineEdit</span><span class="p">,</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bkgScaleLineEdit</span><span class="o">.</span><span class="n">returnPressed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subtract_bkg</span><span class="p">)</span>
        <span class="n">col</span><span class="o">+=</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bkgSubPushButton</span><span class="o">=</span><span class="n">QPushButton</span><span class="p">(</span><span class="s1">&#39;Subtract Bkg&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bkgSubPushButton</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subtract_bkg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bkgSubPushButton</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataDockLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bkgSubPushButton</span><span class="p">,</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">,</span><span class="n">colspan</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        
        <span class="n">row</span><span class="o">+=</span><span class="mi">1</span>
        <span class="n">col</span><span class="o">=</span><span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">processTypeComboBox</span><span class="o">=</span><span class="n">QComboBox</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">processTypeComboBox</span><span class="o">.</span><span class="n">addItems</span><span class="p">([</span><span class="s1">&#39;Mean&#39;</span><span class="p">,</span><span class="s1">&#39;Sum&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">processPushButton</span><span class="o">=</span><span class="n">QPushButton</span><span class="p">(</span><span class="s1">&#39;Process&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">processPushButton</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">processData</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataDockLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">processTypeComboBox</span><span class="p">,</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
        <span class="n">col</span><span class="o">+=</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataDockLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">processPushButton</span><span class="p">,</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">,</span><span class="n">colspan</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">col</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">saveDataPushButton</span> <span class="o">=</span> <span class="n">QPushButton</span><span class="p">(</span><span class="s1">&#39;Save processed data&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataDockLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">saveDataPushButton</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">,</span> <span class="n">colspan</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">saveDataPushButton</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_processed_data</span><span class="p">)</span>
        
        
        <span class="n">row</span><span class="o">+=</span><span class="mi">1</span>
        <span class="n">col</span><span class="o">=</span><span class="mi">0</span>
<span class="c1">#        self.thicknessCheckBox=QCheckBox(&#39;Sample thickness (cm)&#39;)</span>
<span class="c1">#        self.thicknessCheckBox.setTristate(False)</span>
<span class="c1">#        self.thicknessCheckBox.stateChanged.connect(self.thicknessChanged)</span>
<span class="c1">#        self.dataDockLayout.addWidget(self.thicknessCheckBox,row,col)</span>
        <span class="n">thicknessLabel</span><span class="o">=</span><span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;Sample Thickness (cm)&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataDockLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">thicknessLabel</span><span class="p">,</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">)</span>
        <span class="n">col</span><span class="o">+=</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thicknessLineEdit</span><span class="o">=</span><span class="n">QLineEdit</span><span class="p">(</span><span class="s1">&#39;1.0&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thicknessLineEdit</span><span class="o">.</span><span class="n">returnPressed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thicknessChanged</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataDockLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thicknessLineEdit</span><span class="p">,</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">,</span><span class="n">colspan</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="c1">#self.thicknessLineEdit.returnPressed.connect(self.subtract_bkg)</span>
        
        <span class="n">row</span><span class="o">+=</span><span class="mi">1</span>
        <span class="n">col</span><span class="o">=</span><span class="mi">0</span>
        <span class="n">standardLabel</span><span class="o">=</span><span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;Standard&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataDockLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">standardLabel</span><span class="p">,</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
        <span class="n">col</span><span class="o">+=</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">standardComboBox</span><span class="o">=</span><span class="n">QComboBox</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">standardComboBox</span><span class="o">.</span><span class="n">addItems</span><span class="p">([</span><span class="s1">&#39;GC&#39;</span><span class="p">,</span><span class="s1">&#39;Water&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataDockLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">standardComboBox</span><span class="p">,</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">,</span><span class="n">colspan</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        
        <span class="n">row</span><span class="o">+=</span><span class="mi">1</span>
        <span class="n">col</span><span class="o">=</span><span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CFLineEdit</span><span class="o">=</span><span class="n">QLineEdit</span><span class="p">(</span><span class="s1">&#39;1.0&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CF</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CFLineEdit</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataDockLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CFLineEdit</span><span class="p">,</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CFLineEdit</span><span class="o">.</span><span class="n">returnPressed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CF_changed</span><span class="p">)</span>
        <span class="n">col</span><span class="o">+=</span><span class="mi">1</span>
        <span class="c1">#qminqmaxLabel=QLabel(&#39;Q-range&#39;)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qminqmaxLineEdit</span><span class="o">=</span><span class="n">QLineEdit</span><span class="p">(</span><span class="s1">&#39;0.0:1.0&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataDockLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qminqmaxLineEdit</span><span class="p">,</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">,</span><span class="n">colspan</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qminqmaxLineEdit</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s1">&#39;Qmin:Qmax for CF calculation&#39;</span><span class="p">)</span>
        
        
        <span class="n">row</span><span class="o">+=</span><span class="mi">1</span>
        <span class="n">col</span><span class="o">=</span><span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calcCFPushButton</span><span class="o">=</span><span class="n">QPushButton</span><span class="p">(</span><span class="s1">&#39;Calculate CF&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calcCFPushButton</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">calc_cal_factor</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataDockLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">calcCFPushButton</span><span class="p">,</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
        <span class="n">col</span><span class="o">+=</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">applyCFPushButton</span><span class="o">=</span><span class="n">QPushButton</span><span class="p">(</span><span class="s1">&#39;Apply CF&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">applyCFPushButton</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">apply_calc_factor</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataDockLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">applyCFPushButton</span><span class="p">,</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">,</span><span class="n">colspan</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
   
        
        <span class="n">row</span><span class="o">+=</span><span class="mi">1</span>
        <span class="n">col</span><span class="o">=</span><span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">checkDataSpinBox</span><span class="o">=</span><span class="n">QSpinBox</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataDockLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">checkDataSpinBox</span><span class="p">,</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
        
        <span class="n">col</span><span class="o">+=</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">checkDataPushButton</span><span class="o">=</span><span class="n">QPushButton</span><span class="p">(</span><span class="s1">&#39;Check Data&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">checkDataPushButton</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">checkData</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataDockLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">checkDataPushButton</span><span class="p">,</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
        <span class="n">col</span><span class="o">+=</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">saveCheckDataPushButton</span><span class="o">=</span><span class="n">QPushButton</span><span class="p">(</span><span class="s1">&#39;Save Data&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">saveCheckDataPushButton</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">saveCheckData</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataDockLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">saveCheckDataPushButton</span><span class="p">,</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
        
        
        <span class="n">row</span><span class="o">+=</span><span class="mi">1</span>
        <span class="n">col</span><span class="o">=</span><span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elementCheckBox</span><span class="o">=</span><span class="n">QCheckBox</span><span class="p">(</span><span class="s1">&#39;Elements&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataDockLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elementCheckBox</span><span class="p">,</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
        <span class="n">col</span><span class="o">+=</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elementsLineEdit</span><span class="o">=</span><span class="n">QLineEdit</span><span class="p">(</span><span class="s1">&#39;x, Rb&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataDockLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elementsLineEdit</span><span class="p">,</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">,</span><span class="n">colspan</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        
        
        <span class="n">row</span><span class="o">+=</span><span class="mi">1</span>
        <span class="n">col</span><span class="o">=</span><span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ASAXSCalcTypeComboBox</span><span class="o">=</span><span class="n">QComboBox</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ASAXSCalcTypeComboBox</span><span class="o">.</span><span class="n">addItems</span><span class="p">([</span><span class="s1">&#39;single&#39;</span><span class="p">,</span><span class="s1">&#39;multiple&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataDockLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ASAXSCalcTypeComboBox</span><span class="p">,</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
        <span class="n">col</span><span class="o">+=</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calcASAXSPushButton</span><span class="o">=</span><span class="n">QPushButton</span><span class="p">(</span><span class="s1">&#39;Calculate scattering components&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calcASAXSPushButton</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ASAXS_split</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataDockLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">calcASAXSPushButton</span><span class="p">,</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">,</span><span class="n">colspan</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        
        <span class="c1">#row+=1</span>
        <span class="c1">#col=0</span>
        <span class="c1">#self.checkComponentsPushButton=QPushButton(&#39;Check component ratios&#39;)</span>
        <span class="c1">#self.checkComponentsPushButton.clicked.connect(self.check_components)</span>
        <span class="c1">#self.dataDockLayout.addWidget(self.checkComponentsPushButton,row=row,col=col,colspan=3)</span>
        
        <span class="n">row</span><span class="o">+=</span><span class="mi">1</span>
        <span class="n">col</span><span class="o">=</span><span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">saveASAXSPushButton</span><span class="o">=</span><span class="n">QPushButton</span><span class="p">(</span><span class="s1">&#39;Save Scattering Components&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">saveASAXSPushButton</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">save_ASAXS</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">saveASAXSPushButton</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataDockLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">saveASAXSPushButton</span><span class="p">,</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">,</span><span class="n">colspan</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">dataDock</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataDockLayout</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">batchProcess</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

<div class="viewcode-block" id="ASAXS_Widget.calc_cal_factor"><a class="viewcode-back" href="../SAXS_Drive_link.html#ASAXS_widget.ASAXS_Widget.calc_cal_factor">[docs]</a>    <span class="k">def</span> <span class="nf">calc_cal_factor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates the calibration factor using Intensity calibration sample. At present only Glassy carbon is used.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataListWidget</span><span class="o">.</span><span class="n">selectedItems</span><span class="p">())</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">fname</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dataListWidget</span><span class="o">.</span><span class="n">selectedItems</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;: &#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">qminqmaxLineEdit</span><span class="o">.</span><span class="n">text</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
<span class="c1">#            try:</span>
            <span class="n">xmin</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">xmin</span><span class="p">)</span>
            <span class="n">xmax</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">xmax</span><span class="p">)</span>
            <span class="n">standard</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">standardComboBox</span><span class="o">.</span><span class="n">currentText</span><span class="p">())</span>
            <span class="n">thickness</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thicknessLineEdit</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
            <span class="n">energy</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">CF</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">calc_cf</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span><span class="n">standard</span><span class="o">=</span><span class="n">standard</span><span class="p">,</span><span class="n">thickness</span><span class="o">=</span><span class="n">thickness</span><span class="p">,</span><span class="n">xmin</span><span class="o">=</span><span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span><span class="o">=</span><span class="n">xmax</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CFLineEdit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%.5f</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CF</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dataPlotWidget</span><span class="o">.</span><span class="n">add_data</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">yerr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;std-data&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">apply_calc_factor</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dataPlotWidget</span><span class="o">.</span><span class="n">Plot</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">dataListWidget</span><span class="o">.</span><span class="n">selectedItems</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;: &#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span><span class="s1">&#39;std-data&#39;</span><span class="p">])</span>
<span class="c1">#            except:</span>
<span class="c1">#                QMessageBox.warning(self,&#39;Value Error&#39;,&#39;Please provide the Qmin and QMax in qmin:qmax format and Thickness in numerical values in centimeters&#39;)</span>
<span class="c1">#                return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">QMessageBox</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;Selection Error&#39;</span><span class="p">,</span><span class="s1">&#39;Please select a single file for calibration factor calculation.&#39;</span><span class="p">,</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span></div>
            
<div class="viewcode-block" id="ASAXS_Widget.dataBaseChanged"><a class="viewcode-back" href="../SAXS_Drive_link.html#ASAXS_widget.ASAXS_Widget.dataBaseChanged">[docs]</a>    <span class="k">def</span> <span class="nf">dataBaseChanged</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Selects the X-ray database</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataBase</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xrayDataBaseComboBox</span><span class="o">.</span><span class="n">currentText</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elementChanged</span><span class="p">()</span></div>

<div class="viewcode-block" id="ASAXS_Widget.apply_calc_factor"><a class="viewcode-back" href="../SAXS_Drive_link.html#ASAXS_widget.ASAXS_Widget.apply_calc_factor">[docs]</a>    <span class="k">def</span> <span class="nf">apply_calc_factor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Apply the current calibration factor to all the selected data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ans</span><span class="o">=</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">question</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;Confirm&#39;</span><span class="p">,</span><span class="s1">&#39;Are you sure of applying CF to the selected data?&#39;</span><span class="p">,</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">No</span><span class="p">,</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Yes</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ans</span><span class="o">==</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Yes</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataListWidget</span><span class="o">.</span><span class="n">selectedItems</span><span class="p">():</span>
                <span class="n">fname</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;: &#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="s1">&#39;CF&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">CF</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dataSelectionChanged</span><span class="p">()</span></div>
        
<div class="viewcode-block" id="ASAXS_Widget.elementChanged"><a class="viewcode-back" href="../SAXS_Drive_link.html#ASAXS_widget.ASAXS_Widget.elementChanged">[docs]</a>    <span class="k">def</span> <span class="nf">elementChanged</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function is triggered when the current index of elementComboBox changed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elementEdgeComboBox</span><span class="o">.</span><span class="n">currentIndexChanged</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elementEdgeComboBox</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="n">element</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elementComboBox</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;: &#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">edges</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">xrdb</span><span class="o">.</span><span class="n">xray_edges</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elementEdgeComboBox</span><span class="o">.</span><span class="n">addItems</span><span class="p">([</span><span class="n">key</span><span class="o">+</span><span class="s1">&#39;: </span><span class="si">%.4f</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">edges</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">edge</span><span class="o">/</span><span class="mi">1000</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">edges</span><span class="o">.</span><span class="n">keys</span><span class="p">()])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elementEdgeComboBox</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elementEdgeComboBox</span><span class="o">.</span><span class="n">currentIndexChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edgeChanged</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edgeChanged</span><span class="p">()</span></div>
        
        
<div class="viewcode-block" id="ASAXS_Widget.edgeChanged"><a class="viewcode-back" href="../SAXS_Drive_link.html#ASAXS_widget.ASAXS_Widget.edgeChanged">[docs]</a>    <span class="k">def</span> <span class="nf">edgeChanged</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function is triggerred when the current index ov edgeComboBox Changed</span>
<span class="sd">        &quot;&quot;&quot;</span>     
        <span class="bp">self</span><span class="o">.</span><span class="n">edgeEnergy</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elementEdgeComboBox</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;: &#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EminLineEdit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%.4f</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="mf">0.9</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">edgeEnergy</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EmaxLineEdit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%.4f</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="mf">1.1</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">edgeEnergy</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataSelectionChanged</span><span class="p">()</span></div>
        
        
        
<div class="viewcode-block" id="ASAXS_Widget.update_edgePlot"><a class="viewcode-back" href="../SAXS_Drive_link.html#ASAXS_widget.ASAXS_Widget.update_edgePlot">[docs]</a>    <span class="k">def</span> <span class="nf">update_edgePlot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updates the edgePlot</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#try:</span>
        <span class="n">emin</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">EminLineEdit</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
        <span class="n">emax</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">EmaxLineEdit</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
        <span class="n">esteps</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">EstepsLineEdit</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EOff</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">EOffLineEdit</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delE</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">delELineEdit</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edgeEnergy</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elementEdgeComboBox</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lstrip</span><span class="p">())</span>
        <span class="n">element</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elementComboBox</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;: &#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>    
        <span class="bp">self</span><span class="o">.</span><span class="n">Evals</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">emin</span><span class="p">,</span><span class="n">emax</span><span class="p">,</span><span class="n">esteps</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calc_f1</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">calc_f2</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_f1_f2</span><span class="p">(</span><span class="n">element</span><span class="o">=</span><span class="n">element</span><span class="p">,</span><span class="n">energy</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Evals</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">EOff</span><span class="p">))</span>
        <span class="c1">#self.calc_f1=self.xrdb.f1_chantler(element=element,energy=(self.Evals-self.EOff)*1000)</span>
        <span class="c1">#self.calc_f2=self.xrdb.f2_chantler(element=element,energy=(self.Evals-self.EOff)*1000)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">delE</span><span class="o">&gt;=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Evals</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">Evals</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="c1"># dE=np.arange(-20.0*self.delE,20.0*self.delE,self.Evals[1]-self.Evals[0])</span>
            <span class="c1"># kern=np.exp(-dE**2/2.0/self.delE**2)/np.sqrt(2*np.pi)/self.delE</span>
            <span class="c1"># self.calc_f1=fftconvolve(self.calc_f1,kern,mode=&#39;valid&#39;)*(self.Evals[1]-self.Evals[0])</span>
            <span class="c1"># self.calc_f2=fftconvolve(self.calc_f2,kern,mode=&#39;valid&#39;)*(self.Evals[1]-self.Evals[0])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">edgePlotWidget</span><span class="o">.</span><span class="n">setYLabel</span><span class="p">(</span><span class="s1">&#39;Effective scattering factors&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>                         
            <span class="bp">self</span><span class="o">.</span><span class="n">edgePlotWidget</span><span class="o">.</span><span class="n">setYLabel</span><span class="p">(</span><span class="s1">&#39;Scattering factors&#39;</span><span class="p">)</span>
        <span class="c1"># win=int((len(self.Evals)-len(self.calc_f1))/2)</span>
        <span class="c1"># if win&gt;0:</span>
        <span class="c1">#     self.edgePlotWidget.add_data(self.Evals[win:-win],self.calc_f1,name=&#39;f1&#39;)</span>
        <span class="c1">#     self.edgePlotWidget.add_data(self.Evals[win:-win],self.calc_f2,name=&#39;f2&#39;)</span>
        <span class="c1"># else:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edgePlotWidget</span><span class="o">.</span><span class="n">add_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Evals</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_f1</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;f1&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edgePlotWidget</span><span class="o">.</span><span class="n">add_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Evals</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_f2</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;f2&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edgePlotWidget</span><span class="o">.</span><span class="n">Plot</span><span class="p">([</span><span class="s1">&#39;f1&#39;</span><span class="p">,</span><span class="s1">&#39;f2&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edgePlotWidget</span><span class="o">.</span><span class="n">updatePlot</span><span class="p">()</span></div>
        <span class="c1">#except:</span>
        <span class="c1">#    QMessageBox.warning(self,&#39;Value error&#39;,&#39;Please input numeric values only&#39;,QMessageBox.Ok)</span>
        
<div class="viewcode-block" id="ASAXS_Widget.import_data"><a class="viewcode-back" href="../SAXS_Drive_link.html#ASAXS_widget.ASAXS_Widget.import_data">[docs]</a>    <span class="k">def</span> <span class="nf">import_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Imports data to populate the dataListWidget</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataListWidget</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fCounter</span><span class="o">=</span><span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataFiles</span><span class="o">=</span><span class="n">QFileDialog</span><span class="o">.</span><span class="n">getOpenFileNames</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">caption</span><span class="o">=</span><span class="s1">&#39;Import data&#39;</span><span class="p">,</span><span class="n">directory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dataDir</span><span class="p">,</span><span class="nb">filter</span><span class="o">=</span><span class="s1">&#39;Data files (*.dat *.txt *.chi)&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataFiles</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dataDir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataFiles</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">progressDialog</span><span class="o">=</span><span class="n">QProgressDialog</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">progressDialog</span><span class="o">.</span><span class="n">setMinimum</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">progressDialog</span><span class="o">.</span><span class="n">setMaximum</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataFiles</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">progressDialog</span><span class="o">.</span><span class="n">open</span><span class="p">()</span>
            <span class="n">fnum</span><span class="o">=</span><span class="mi">0</span>
            <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataFiles</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">file</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">item</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fCounter</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;: &#39;</span><span class="o">+</span><span class="n">file</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dataListWidget</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">read_data</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dataListWidget</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataListWidget</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%.4f</span><span class="s1"> keV&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">file</span><span class="p">][</span><span class="s1">&#39;Energy&#39;</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fCounter</span><span class="o">+=</span><span class="mi">1</span>
                    <span class="n">fnum</span><span class="o">+=</span><span class="mi">1</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">progressDialog</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">fnum</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">progressDialog</span><span class="o">.</span><span class="n">setLabelText</span><span class="p">(</span><span class="s1">&#39;Read file: </span><span class="si">%s</span><span class="s1"> successfully.&#39;</span><span class="o">%</span><span class="n">file</span><span class="p">)</span>
                    <span class="n">QApplication</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">QMessageBox</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;Import error&#39;</span><span class="p">,</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> is already imported. Please remove the file to import it again&#39;</span><span class="o">%</span><span class="n">file</span><span class="p">,</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">initialize_metaDataPlotDock</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xAxisComboBox</span><span class="o">.</span><span class="n">addItems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metaKeys</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">yAxisComboBox</span><span class="o">.</span><span class="n">addItems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metaKeys</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">normAxisComboBox</span><span class="o">.</span><span class="n">addItems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metaKeys</span><span class="p">)</span></div>
        
        
            
<div class="viewcode-block" id="ASAXS_Widget.calc_XRF_baseline"><a class="viewcode-back" href="../SAXS_Drive_link.html#ASAXS_widget.ASAXS_Widget.calc_XRF_baseline">[docs]</a>    <span class="k">def</span> <span class="nf">calc_XRF_baseline</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates the XRF baseline for estimating XRF-backgrounds from the selected data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataListWidget</span><span class="o">.</span><span class="n">selectedItems</span><span class="p">())</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">fname</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataListWidget</span><span class="o">.</span><span class="n">selectedItems</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;: &#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xrfFile</span><span class="o">=</span><span class="n">fname</span>
            <span class="n">minf</span><span class="p">,</span><span class="n">maxf</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">xrfBkgRangeLineEdit</span><span class="o">.</span><span class="n">text</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
            <span class="n">xf_bkg_min</span><span class="p">,</span><span class="n">xf_bkg_max</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">minf</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">xrfFile</span><span class="p">][</span><span class="s1">&#39;x&#39;</span><span class="p">])</span><span class="o">/</span><span class="mf">100.0</span><span class="p">,</span><span class="nb">float</span><span class="p">(</span><span class="n">maxf</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">xrfFile</span><span class="p">][</span><span class="s1">&#39;x&#39;</span><span class="p">])</span><span class="o">/</span><span class="mf">100.0</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">xrf_base</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">xrfFile</span><span class="p">][</span><span class="s1">&#39;y&#39;</span><span class="p">][</span><span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">xrfFile</span><span class="p">][</span><span class="s1">&#39;x&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="n">xf_bkg_min</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span><span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">xrfFile</span><span class="p">][</span><span class="s1">&#39;x&#39;</span><span class="p">]</span><span class="o">&lt;</span><span class="n">xf_bkg_max</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]])</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">xrf_base</span><span class="o">=</span><span class="mf">0.0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xrfBkgLineEdit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%.3e</span><span class="s1">&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">xrf_base</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">QMessageBox</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;Selection Error&#39;</span><span class="p">,</span><span class="s1">&#39;Please select only one data set.&#39;</span><span class="p">,</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span></div>
        
<div class="viewcode-block" id="ASAXS_Widget.read_data"><a class="viewcode-back" href="../SAXS_Drive_link.html#ASAXS_widget.ASAXS_Widget.read_data">[docs]</a>    <span class="k">def</span> <span class="nf">read_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">item</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads the data while importing the files in the listWidget</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">smoothCheckBox</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mooreACSmoothingCheckBox</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">num</span><span class="p">,</span><span class="n">fname</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;: &#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">=</span><span class="n">read1DSAXS</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">metaKeys</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">metaKeys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CFLineEdit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%.3f</span><span class="s1">&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="s1">&#39;CF&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thicknessLineEdit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%.5f</span><span class="s1">&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="s1">&#39;Thickness&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataPlotWidget</span><span class="o">.</span><span class="n">add_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="s1">&#39;x&#39;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="s1">&#39;CF&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="s1">&#39;y&#39;</span><span class="p">]</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="s1">&#39;Thickness&#39;</span><span class="p">],</span><span class="n">yerr</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="s1">&#39;CF&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="s1">&#39;yerr&#39;</span><span class="p">]</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="s1">&#39;Thickness&#39;</span><span class="p">],</span><span class="n">name</span><span class="o">=</span><span class="n">num</span><span class="p">)</span></div>
        
<div class="viewcode-block" id="ASAXS_Widget.remove_data"><a class="viewcode-back" href="../SAXS_Drive_link.html#ASAXS_widget.ASAXS_Widget.remove_data">[docs]</a>    <span class="k">def</span> <span class="nf">remove_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes selected data from the dataListWidget</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ans</span><span class="o">=</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">question</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;Confirm&#39;</span><span class="p">,</span><span class="s1">&#39;Are you sure you want to remove the data from the program?&#39;</span><span class="p">,</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">No</span><span class="p">,</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Yes</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ans</span><span class="o">==</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Yes</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dataListWidget</span><span class="o">.</span><span class="n">itemSelectionChanged</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
            <span class="n">sel_rows</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dataListWidget</span><span class="o">.</span><span class="n">row</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataListWidget</span><span class="o">.</span><span class="n">selectedItems</span><span class="p">()]</span>
            <span class="n">sel_rows</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">sel_rows</span><span class="p">:</span>
                <span class="n">fname</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataListWidget</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">row</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;: &#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
                <span class="c1">#if fname!=self.xrfFile:</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dataListWidget</span><span class="o">.</span><span class="n">takeItem</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dataListWidget</span><span class="o">.</span><span class="n">itemSelectionChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataSelectionChanged</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataSelectionChanged</span><span class="p">()</span></div>
            
<div class="viewcode-block" id="ASAXS_Widget.save_processed_data"><a class="viewcode-back" href="../SAXS_Drive_link.html#ASAXS_widget.ASAXS_Widget.save_processed_data">[docs]</a>    <span class="k">def</span> <span class="nf">save_processed_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Saves the data with currently processed settings</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fnames</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">fname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fnames</span><span class="p">:</span>
                <span class="n">pfname</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">fname</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_proc&#39;</span><span class="o">+</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">fname</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">header</span><span class="o">=</span><span class="s1">&#39;Processed data on </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">time</span><span class="o">.</span><span class="n">asctime</span><span class="p">()</span>
                <span class="n">header</span><span class="o">=</span><span class="s1">&#39;Original file=</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">fname</span>
                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">key</span><span class="o">!=</span><span class="s1">&#39;x&#39;</span> <span class="ow">and</span> <span class="n">key</span><span class="o">!=</span><span class="s1">&#39;y&#39;</span> <span class="ow">and</span> <span class="n">key</span><span class="o">!=</span><span class="s1">&#39;yerr&#39;</span> <span class="ow">and</span> <span class="n">key</span><span class="o">!=</span><span class="s1">&#39;xintp&#39;</span> <span class="ow">and</span> <span class="n">key</span><span class="o">!=</span><span class="s1">&#39;yintp&#39;</span> <span class="ow">and</span> <span class="n">key</span><span class="o">!=</span><span class="s1">&#39;yintperr&#39;</span> <span class="ow">and</span> <span class="n">key</span><span class="o">!=</span><span class="s1">&#39;y-flb&#39;</span><span class="p">:</span>
                        <span class="n">header</span><span class="o">=</span><span class="n">header</span><span class="o">+</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">=</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="n">key</span><span class="p">])</span>
                <span class="n">header</span><span class="o">=</span><span class="n">header</span><span class="o">+</span><span class="s1">&#39;Q (A^-1)</span><span class="se">\t</span><span class="s1">Intensity</span><span class="se">\t</span><span class="s1">Intensity_error</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">pfname</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="s1">&#39;x&#39;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="s1">&#39;y&#39;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="s1">&#39;yerr&#39;</span><span class="p">]))</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">comments</span><span class="o">=</span><span class="s1">&#39;#&#39;</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="n">header</span><span class="p">)</span>
            <span class="n">QMessageBox</span><span class="o">.</span><span class="n">information</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;Saving info&#39;</span><span class="p">,</span><span class="s1">&#39;The selected processed file/s is/are saved in the same folder as the selected data.&#39;</span><span class="p">,</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">QMessageBox</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;Selection error&#39;</span><span class="p">,</span><span class="s1">&#39;No data selected to save&#39;</span><span class="p">,</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span></div>
        
<div class="viewcode-block" id="ASAXS_Widget.CF_changed"><a class="viewcode-back" href="../SAXS_Drive_link.html#ASAXS_widget.ASAXS_Widget.CF_changed">[docs]</a>    <span class="k">def</span> <span class="nf">CF_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calibration factor changed for the selected data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">fname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fnames</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="s1">&#39;CF&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CFLineEdit</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dataSelectionChanged</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">QMessageBox</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;Selection Error&#39;</span><span class="p">,</span><span class="s1">&#39;Please select a data set or group of data set to change the calibraiton factor&#39;</span><span class="p">,</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span></div>
            
<div class="viewcode-block" id="ASAXS_Widget.dataSelectionChanged"><a class="viewcode-back" href="../SAXS_Drive_link.html#ASAXS_widget.ASAXS_Widget.dataSelectionChanged">[docs]</a>    <span class="k">def</span> <span class="nf">dataSelectionChanged</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This triggers when the item selection changes in the dataListWidget</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_edgePlot</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">datanames</span><span class="o">=</span><span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;: &#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataListWidget</span><span class="o">.</span><span class="n">selectedItems</span><span class="p">()]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fnames</span><span class="o">=</span><span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;: &#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataListWidget</span><span class="o">.</span><span class="n">selectedItems</span><span class="p">()]</span>
        <span class="c1">#self.initialize_metaDataPlotDock()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metaData</span><span class="o">=</span><span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metaData</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metaData</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metaData</span><span class="p">[</span><span class="s1">&#39;norm&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">xname</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xAxisComboBox</span><span class="o">.</span><span class="n">currentText</span><span class="p">())</span>
        <span class="n">yname</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yAxisComboBox</span><span class="o">.</span><span class="n">currentText</span><span class="p">())</span>
        <span class="n">normname</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">normAxisComboBox</span><span class="o">.</span><span class="n">currentText</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fnames</span><span class="p">)):</span>
            <span class="n">fname</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fnames</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CFLineEdit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%.3f</span><span class="s1">&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="s1">&#39;CF&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">thicknessLineEdit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%.5f</span><span class="s1">&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="s1">&#39;Thickness&#39;</span><span class="p">])</span>
            <span class="c1">#Collecting meta data to plot</span>
            <span class="k">if</span> <span class="n">xname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> <span class="n">yname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">metaData</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="n">xname</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">metaData</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="n">yname</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">normname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">metaData</span><span class="p">[</span><span class="s1">&#39;norm&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="n">normname</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">metaData</span><span class="p">[</span><span class="s1">&#39;norm&#39;</span><span class="p">]</span><span class="o">=</span><span class="mf">1.0</span>
            <span class="c1">#Doing the fluorescence correction</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">xrfBkgCheckBox</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                <span class="n">minf</span><span class="p">,</span><span class="n">maxf</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">xrfBkgRangeLineEdit</span><span class="o">.</span><span class="n">text</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
                <span class="n">xf_bkg_min</span><span class="p">,</span><span class="n">xf_bkg_max</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">minf</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="s1">&#39;x&#39;</span><span class="p">])</span><span class="o">/</span><span class="mf">100.0</span><span class="p">,</span><span class="nb">float</span><span class="p">(</span><span class="n">maxf</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="s1">&#39;x&#39;</span><span class="p">])</span><span class="o">/</span><span class="mf">100.0</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="s1">&#39;xrf_bkg&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="s1">&#39;y&#39;</span><span class="p">][</span><span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="s1">&#39;x&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="n">xf_bkg_min</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span><span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="s1">&#39;x&#39;</span><span class="p">]</span><span class="o">&lt;</span><span class="n">xf_bkg_max</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]])</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">xrf_base</span>
                <span class="k">except</span><span class="p">:</span><span class="c1">#In case no data found between the range provided</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="s1">&#39;xrf_bkg&#39;</span><span class="p">]</span><span class="o">=</span><span class="mf">0.0</span>
                <span class="c1">#self.data[fname][&#39;y-flb&#39;]=self.data[fname][&#39;CF&#39;]*(self.data[fname][&#39;y&#39;]-self.xrf_bkg[fname])/self.data[fname][&#39;Thickness&#39;]</span>
                <span class="c1">#self.dataPlotWidget.add_data(self.data[fname][&#39;x&#39;],self.data[fname][&#39;y-flb&#39;],yerr=self.data[fname][&#39;CF&#39;]*self.data[fname][&#39;yerr&#39;]/self.data[fname][&#39;Thickness&#39;],name=self.datanames[i])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="s1">&#39;xrf_bkg&#39;</span><span class="p">]</span><span class="o">=</span><span class="mf">0.0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dataPlotWidget</span><span class="o">.</span><span class="n">add_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="s1">&#39;x&#39;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="s1">&#39;CF&#39;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="s1">&#39;y&#39;</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="s1">&#39;xrf_bkg&#39;</span><span class="p">])</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="s1">&#39;Thickness&#39;</span><span class="p">],</span><span class="n">yerr</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="s1">&#39;CF&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="s1">&#39;yerr&#39;</span><span class="p">]</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="s1">&#39;Thickness&#39;</span><span class="p">],</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">datanames</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metaData</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metaData</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metaData</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metaData</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metaData</span><span class="p">[</span><span class="s1">&#39;norm&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metaData</span><span class="p">[</span><span class="s1">&#39;norm&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metaDataPlotWidget</span><span class="o">.</span><span class="n">setXLabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xAxisComboBox</span><span class="o">.</span><span class="n">currentText</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metaDataPlotWidget</span><span class="o">.</span><span class="n">setYLabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yAxisComboBox</span><span class="o">.</span><span class="n">currentText</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metaDataPlotWidget</span><span class="o">.</span><span class="n">add_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metaData</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">metaData</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">metaData</span><span class="p">[</span><span class="s1">&#39;norm&#39;</span><span class="p">],</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">yAxisComboBox</span><span class="o">.</span><span class="n">currentText</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metaDataPlotWidget</span><span class="o">.</span><span class="n">Plot</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">yAxisComboBox</span><span class="o">.</span><span class="n">currentText</span><span class="p">()])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataPlotWidget</span><span class="o">.</span><span class="n">Plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">datanames</span><span class="p">)</span>
        <span class="n">element</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elementComboBox</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;: &#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">minEnergy</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;Energy&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">()])</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">minEnergy</span><span class="o">=</span><span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataListWidget</span><span class="o">.</span><span class="n">selectedItems</span><span class="p">():</span>
            <span class="n">dataname</span><span class="p">,</span> <span class="n">fname</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;: &#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">energyLines</span><span class="p">[</span><span class="n">fname</span><span class="p">]</span><span class="o">=</span><span class="n">pg</span><span class="o">.</span><span class="n">InfiniteLine</span><span class="p">(</span><span class="n">pos</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="s1">&#39;Energy&#39;</span><span class="p">],</span><span class="n">pen</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dataPlotWidget</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">dataname</span><span class="p">]</span><span class="o">.</span><span class="n">opts</span><span class="p">[</span><span class="s1">&#39;pen&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">edgePlotWidget</span><span class="o">.</span><span class="n">plotWidget</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">energyLines</span><span class="p">[</span><span class="n">fname</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="s1">&#39;f1&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="s1">&#39;f2&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_f1_f2</span><span class="p">(</span><span class="n">element</span><span class="o">=</span><span class="n">element</span><span class="p">,</span><span class="n">energy</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="s1">&#39;Energy&#39;</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">EOff</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="s1">&#39;f1&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="s1">&#39;f1&#39;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span><span class="o">+</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">linearOffsetLineEdit</span><span class="o">.</span><span class="n">text</span><span class="p">())</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="s1">&#39;Energy&#39;</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">minEnergy</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">edgePlotWidget</span><span class="o">.</span><span class="n">plotWidget</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="s1">&#39;Energy&#39;</span><span class="p">]],[</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="s1">&#39;f1&#39;</span><span class="p">]],</span><span class="n">pen</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">symbol</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">symbolPen</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dataPlotWidget</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">dataname</span><span class="p">]</span><span class="o">.</span><span class="n">opts</span><span class="p">[</span><span class="s1">&#39;pen&#39;</span><span class="p">],</span><span class="n">symbolBrush</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">datanames</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xrfBkgCheckBox</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xrfBkgRangeLineEdit</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xrfBkgCheckBox</span><span class="o">.</span><span class="n">setCheckState</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">Unchecked</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xrfBkgCheckBox</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xrfBkgRangeLineEdit</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">bkgSubPushButton</span><span class="o">.</span><span class="n">setDisabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">datanames</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bkgSubPushButton</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span></div>
        <span class="c1">#self.raiseDock(self.dataPlotDock)</span>
        
<div class="viewcode-block" id="ASAXS_Widget.subtract_bkg"><a class="viewcode-back" href="../SAXS_Drive_link.html#ASAXS_widget.ASAXS_Widget.subtract_bkg">[docs]</a>    <span class="k">def</span> <span class="nf">subtract_bkg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Out of the two selected data subtracts one from the other to do background subtraction</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataListWidget</span><span class="o">.</span><span class="n">selectedItems</span><span class="p">())</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bkgScale</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bkgScaleLineEdit</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
            <span class="c1">#self.bkgScale=self.data[self.fnames[0]][&#39;BSDiode_corr&#39;]*self.data[self.fnames[1]][&#39;Monitor_corr&#39;]/self.data[self.fnames[0]][&#39;Monitor_corr&#39;]/self.data[self.fnames[1]][&#39;BSDiode_corr&#39;]</span>
            <span class="c1">#self.bkgScaleLineEdit.setText(&#39;%.5f&#39;%self.bkgScale)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">interpolate_data</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span>
            <span class="n">tmp</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fnames</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;yintp&#39;</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">bkgScale</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fnames</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="s1">&#39;yintp&#39;</span><span class="p">])</span>\
                <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fnames</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;Thickness&#39;</span><span class="p">]</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fnames</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;CF&#39;</span><span class="p">]</span>
            <span class="n">tmperr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fnames</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;yintperr&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">bkgScale</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fnames</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="s1">&#39;yintperr&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>\
                <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fnames</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;Thickness&#39;</span><span class="p">]</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fnames</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;CF&#39;</span><span class="p">]</span>
            <span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">qintp</span><span class="p">,</span><span class="n">tmp</span><span class="p">,</span><span class="n">tmperr</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
            <span class="n">filename</span><span class="o">=</span><span class="n">QFileDialog</span><span class="o">.</span><span class="n">getSaveFileName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">caption</span><span class="o">=</span><span class="s1">&#39;Save as&#39;</span><span class="p">,</span><span class="n">directory</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fnames</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="nb">filter</span><span class="o">=</span><span class="s1">&#39;Text files (*.txt)&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">filename</span><span class="o">!=</span><span class="s1">&#39;&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">filename</span><span class="p">]</span><span class="o">=</span><span class="p">{}</span>
                <span class="n">header</span><span class="o">=</span><span class="s1">&#39;Background subtracted data obtained from data1-data2 where</span><span class="se">\n</span><span class="s1"> data1=</span><span class="si">%s</span><span class="s1"> </span><span class="se">\n</span><span class="s1"> data2=</span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fnames</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">fnames</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fnames</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">key</span><span class="o">!=</span><span class="s1">&#39;x&#39;</span> <span class="ow">and</span> <span class="n">key</span><span class="o">!=</span><span class="s1">&#39;y&#39;</span> <span class="ow">and</span> <span class="n">key</span><span class="o">!=</span><span class="s1">&#39;yerr&#39;</span> <span class="ow">and</span> <span class="n">key</span><span class="o">!=</span><span class="s1">&#39;xintp&#39;</span> <span class="ow">and</span> <span class="n">key</span><span class="o">!=</span><span class="s1">&#39;yintp&#39;</span> <span class="ow">and</span> <span class="n">key</span><span class="o">!=</span><span class="s1">&#39;yintperr&#39;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">filename</span><span class="p">][</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fnames</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">key</span><span class="p">]</span>
                        <span class="n">header</span><span class="o">=</span><span class="n">header</span><span class="o">+</span><span class="n">key</span><span class="o">+</span><span class="s1">&#39;=&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fnames</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">key</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">filename</span><span class="p">][</span><span class="s1">&#39;CF&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fnames</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;CF&#39;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">filename</span><span class="p">][</span><span class="s1">&#39;Thickness&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fnames</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;Thickness&#39;</span><span class="p">]</span>
                <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="n">data</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="n">header</span><span class="p">,</span><span class="n">comments</span><span class="o">=</span><span class="s1">&#39;#&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">filename</span><span class="p">][</span><span class="s1">&#39;x&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">qintp</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">filename</span><span class="p">][</span><span class="s1">&#39;y&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">tmp</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">filename</span><span class="p">][</span><span class="s1">&#39;yerr&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">tmperr</span>
                <span class="n">item</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fCounter</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;: &#39;</span><span class="o">+</span><span class="n">filename</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dataListWidget</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dataListWidget</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataListWidget</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">filename</span><span class="p">][</span><span class="s1">&#39;Energy&#39;</span><span class="p">]))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dataPlotWidget</span><span class="o">.</span><span class="n">add_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">filename</span><span class="p">][</span><span class="s1">&#39;x&#39;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">filename</span><span class="p">][</span><span class="s1">&#39;y&#39;</span><span class="p">],</span><span class="n">yerr</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">filename</span><span class="p">][</span><span class="s1">&#39;yerr&#39;</span><span class="p">],</span><span class="n">name</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fCounter</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fCounter</span><span class="o">+=</span><span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dataListWidget</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataListWidget</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">setSelected</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">QMessageBox</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;Data selection error&#39;</span><span class="p">,</span><span class="s1">&#39;Please select only two data for background selection.&#39;</span><span class="p">,</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span></div>
        <span class="c1">#self.fnames.append(filename)</span>
        <span class="c1">#self.dataPlotWidget.Plot(self.fnames)</span>
        
<div class="viewcode-block" id="ASAXS_Widget.processData"><a class="viewcode-back" href="../SAXS_Drive_link.html#ASAXS_widget.ASAXS_Widget.processData">[docs]</a>    <span class="k">def</span> <span class="nf">processData</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Process the selected data for calculating mean and sum</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interpolate_data</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span>
        <span class="n">tdata</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fnames</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;yintp&#39;</span><span class="p">])</span>
        <span class="n">tdata_err</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">tdata</span><span class="p">)</span>
        <span class="n">tlen</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fnames</span><span class="p">)</span>
        <span class="n">monitor</span><span class="o">=</span><span class="mf">0.0</span>
        <span class="n">pDiode</span><span class="o">=</span><span class="mf">0.0</span>
        <span class="n">diode</span><span class="o">=</span><span class="mf">0.0</span>
        <span class="n">pDiodeCorr</span><span class="o">=</span><span class="mf">0.0</span>
        <span class="n">monitorCorr</span><span class="o">=</span><span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">fname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fnames</span><span class="p">:</span>
            <span class="n">tdata</span><span class="o">=</span><span class="n">tdata</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="s1">&#39;yintp&#39;</span><span class="p">]</span>
            <span class="n">tdata_err</span><span class="o">=</span><span class="n">tdata_err</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="s1">&#39;yintperr&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">monitor</span><span class="o">=</span><span class="n">monitor</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="s1">&#39;Monitor&#39;</span><span class="p">]</span>
                <span class="n">pDiode</span><span class="o">=</span><span class="n">pDiode</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="s1">&#39;BSDiode&#39;</span><span class="p">]</span>
                <span class="n">diode</span><span class="o">=</span><span class="n">diode</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="s1">&#39;Diode&#39;</span><span class="p">]</span>
                <span class="n">pDiodeCorr</span><span class="o">=</span><span class="n">pDiodeCorr</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="s1">&#39;BSDiode_corr&#39;</span><span class="p">]</span>
                <span class="n">monitorCorr</span><span class="o">=</span><span class="n">monitorCorr</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="s1">&#39;Monitor_corr&#39;</span><span class="p">]</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">monitor</span><span class="o">=</span><span class="mf">1.0</span>
                <span class="n">pDiode</span><span class="o">=</span><span class="mf">1.0</span>
                <span class="n">diode</span><span class="o">=</span><span class="mf">1.0</span>
                <span class="n">pDiodeCorr</span><span class="o">=</span><span class="mf">1.0</span>
                <span class="n">monitorCorr</span><span class="o">=</span><span class="mf">1.0</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">processTypeComboBox</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span><span class="o">==</span><span class="s1">&#39;Mean&#39;</span><span class="p">:</span>
            <span class="n">tdata</span><span class="o">=</span><span class="n">tdata</span><span class="o">/</span><span class="n">tlen</span>
            <span class="n">tdata_err</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">tdata</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">fname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fnames</span><span class="p">:</span>
                <span class="n">tdata_err</span><span class="o">=</span><span class="n">tdata_err</span><span class="o">+</span><span class="p">(</span><span class="n">tdata</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="s1">&#39;yintp&#39;</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span>
            <span class="n">tdata_err</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">tdata_err</span><span class="o">/</span><span class="n">tlen</span><span class="p">)</span>
            <span class="n">monitor</span><span class="o">=</span><span class="n">monitor</span><span class="o">/</span><span class="n">tlen</span>
            <span class="n">pDiode</span><span class="o">=</span><span class="n">pDiode</span><span class="o">/</span><span class="n">tlen</span>
            <span class="n">diode</span><span class="o">=</span><span class="n">diode</span><span class="o">/</span><span class="n">tlen</span>
            <span class="n">pDiodeCorr</span><span class="o">=</span><span class="n">pDiodeCorr</span><span class="o">/</span><span class="n">tlen</span>
            <span class="n">monitorCorr</span><span class="o">=</span><span class="n">monitorCorr</span><span class="o">/</span><span class="n">tlen</span>
        <span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">qintp</span><span class="p">,</span><span class="n">tdata</span><span class="p">,</span><span class="n">tdata_err</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
        <span class="n">reply</span><span class="o">=</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">question</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;Question&#39;</span><span class="p">,</span><span class="s1">&#39;Do you like to save the processed data as a new file as well?&#39;</span><span class="p">,</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Yes</span><span class="p">,</span><span class="n">QMessageBox</span><span class="o">.</span>
                             <span class="n">No</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">reply</span><span class="o">==</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Yes</span><span class="p">:</span>
            <span class="n">filename</span><span class="o">=</span><span class="n">QFileDialog</span><span class="o">.</span><span class="n">getSaveFileName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">caption</span><span class="o">=</span><span class="s1">&#39;Save as&#39;</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fnames</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="nb">filter</span><span class="o">=</span><span class="s1">&#39;Text files (*.txt)&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">filename</span><span class="o">!=</span><span class="s1">&#39;&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">filename</span><span class="p">]</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fnames</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">filename</span><span class="p">][</span><span class="s1">&#39;x&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">qintp</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">filename</span><span class="p">][</span><span class="s1">&#39;y&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">tdata</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">filename</span><span class="p">][</span><span class="s1">&#39;Thickness&#39;</span><span class="p">]</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">filename</span><span class="p">][</span><span class="s1">&#39;xrf_bkg&#39;</span><span class="p">])</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">filename</span><span class="p">][</span><span class="s1">&#39;CF&#39;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">filename</span><span class="p">][</span><span class="s1">&#39;yerr&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">tdata_err</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">filename</span><span class="p">][</span><span class="s1">&#39;Thickness&#39;</span><span class="p">]</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">filename</span><span class="p">][</span><span class="s1">&#39;CF&#39;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">filename</span><span class="p">][</span><span class="s1">&#39;Monitor&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">monitor</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">filename</span><span class="p">][</span><span class="s1">&#39;Monitor_corr&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">monitorCorr</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">filename</span><span class="p">][</span><span class="s1">&#39;BSDiode&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">pDiode</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">filename</span><span class="p">][</span><span class="s1">&#39;BSDiode_corr&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">pDiodeCorr</span>
                <span class="n">header</span><span class="o">=</span><span class="s1">&#39;Processed data obtained by taking &#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">processTypeComboBox</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span><span class="o">+</span><span class="s1">&#39; over the following files:</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="k">for</span> <span class="n">fname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fnames</span><span class="p">:</span>
                    <span class="n">header</span><span class="o">=</span><span class="n">header</span><span class="o">+</span><span class="n">fname</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">filename</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">key</span><span class="o">!=</span><span class="s1">&#39;x&#39;</span> <span class="ow">and</span> <span class="n">key</span><span class="o">!=</span><span class="s1">&#39;y&#39;</span> <span class="ow">and</span> <span class="n">key</span><span class="o">!=</span><span class="s1">&#39;yerr&#39;</span> <span class="ow">and</span> <span class="n">key</span><span class="o">!=</span><span class="s1">&#39;xintp&#39;</span> <span class="ow">and</span> <span class="n">key</span><span class="o">!=</span><span class="s1">&#39;yintp&#39;</span> <span class="ow">and</span> <span class="n">key</span><span class="o">!=</span><span class="s1">&#39;yintperr&#39;</span><span class="p">:</span>
                        <span class="n">header</span><span class="o">=</span><span class="n">header</span><span class="o">+</span><span class="n">key</span><span class="o">+</span><span class="s1">&#39;=&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">filename</span><span class="p">][</span><span class="n">key</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
                    
                <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="n">data</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="n">header</span><span class="p">,</span><span class="n">comments</span><span class="o">=</span><span class="s1">&#39;#&#39;</span><span class="p">)</span>
                <span class="n">item</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fCounter</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;: &#39;</span><span class="o">+</span><span class="n">filename</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dataListWidget</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dataListWidget</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataListWidget</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">filename</span><span class="p">][</span><span class="s1">&#39;Energy&#39;</span><span class="p">]))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dataPlotWidget</span><span class="o">.</span><span class="n">add_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">filename</span><span class="p">][</span><span class="s1">&#39;x&#39;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">filename</span><span class="p">][</span><span class="s1">&#39;y&#39;</span><span class="p">],</span><span class="n">yerr</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">filename</span><span class="p">][</span><span class="s1">&#39;yerr&#39;</span><span class="p">],</span><span class="n">name</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fCounter</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fCounter</span><span class="o">+=</span><span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dataListWidget</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataListWidget</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">setSelected</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>         </div>
            
        
        
        
<div class="viewcode-block" id="ASAXS_Widget.thicknessChanged"><a class="viewcode-back" href="../SAXS_Drive_link.html#ASAXS_widget.ASAXS_Widget.thicknessChanged">[docs]</a>    <span class="k">def</span> <span class="nf">thicknessChanged</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Changing sample thickness of the selected data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thicknessLineEdit</span><span class="o">.</span><span class="n">text</span><span class="p">())</span><span class="o">&gt;</span><span class="mf">1e-3</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataListWidget</span><span class="o">.</span><span class="n">selectedItems</span><span class="p">():</span>
                <span class="n">fname</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;: &#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="s1">&#39;Thickness&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thicknessLineEdit</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dataSelectionChanged</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">QMessageBox</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;Value error&#39;</span><span class="p">,</span><span class="s1">&#39;Please enter the thickness value above 0.001 or else you need to change the program&#39;</span><span class="p">,</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span></div>
        
            
    
<div class="viewcode-block" id="ASAXS_Widget.create_dataPlotDock"><a class="viewcode-back" href="../SAXS_Drive_link.html#ASAXS_widget.ASAXS_Widget.create_dataPlotDock">[docs]</a>    <span class="k">def</span> <span class="nf">create_dataPlotDock</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This dock holds the plot of all the selected data for further analysis</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataPlotLayout</span><span class="o">=</span><span class="n">pg</span><span class="o">.</span><span class="n">LayoutWidget</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">row</span><span class="o">=</span><span class="mi">0</span>
        <span class="n">col</span><span class="o">=</span><span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">smoothCheckBox</span><span class="o">=</span><span class="n">QCheckBox</span><span class="p">(</span><span class="s1">&#39;Smoothing data&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">smoothCheckBox</span><span class="o">.</span><span class="n">setTristate</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">smoothCheckBox</span><span class="o">.</span><span class="n">stateChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smoothData</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataPlotLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">smoothCheckBox</span><span class="p">,</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
        <span class="n">col</span><span class="o">+=</span><span class="mi">1</span>
        <span class="n">windowLabel</span><span class="o">=</span><span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;Window size&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataPlotLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">windowLabel</span><span class="p">,</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
        <span class="n">col</span><span class="o">+=</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">windowSpinBox</span><span class="o">=</span><span class="n">QSpinBox</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">windowSpinBox</span><span class="o">.</span><span class="n">setMinimum</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">windowSpinBox</span><span class="o">.</span><span class="n">setMaximum</span><span class="p">(</span><span class="mi">101</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">windowSpinBox</span><span class="o">.</span><span class="n">setSingleStep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">windowSpinBox</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">windowChanged</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataPlotLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">windowSpinBox</span><span class="p">,</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
        <span class="n">col</span><span class="o">+=</span><span class="mi">1</span>
        <span class="n">polyDegLabel</span><span class="o">=</span><span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;Degree&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataPlotLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">polyDegLabel</span><span class="p">,</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
        <span class="n">col</span><span class="o">+=</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">polyDegSpinBox</span><span class="o">=</span><span class="n">QSpinBox</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">polyDegSpinBox</span><span class="o">.</span><span class="n">setMaximum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">windowSpinBox</span><span class="o">.</span><span class="n">value</span><span class="p">()</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">polyDegSpinBox</span><span class="o">.</span><span class="n">setMinimum</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">polyDegSpinBox</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">polyDegreeChanged</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataPlotLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">polyDegSpinBox</span><span class="p">,</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
        
        <span class="n">row</span><span class="o">+=</span><span class="mi">1</span>
        <span class="n">col</span><span class="o">=</span><span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mooreACSmoothingCheckBox</span><span class="o">=</span><span class="n">QCheckBox</span><span class="p">(</span><span class="s1">&#39;Moore</span><span class="se">\&#39;</span><span class="s1">s Auto Corr. Smoothing&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mooreACSmoothingCheckBox</span><span class="o">.</span><span class="n">setTristate</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mooreACSmoothingCheckBox</span><span class="o">.</span><span class="n">stateChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">applyMooresAC</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataPlotLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mooreACSmoothingCheckBox</span><span class="p">,</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
        <span class="n">col</span><span class="o">+=</span><span class="mi">1</span>
        <span class="n">DmaxLabel</span><span class="o">=</span><span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;Dmax (Angs)&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataPlotLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">DmaxLabel</span><span class="p">,</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
        <span class="n">col</span><span class="o">+=</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DmaxLineEdit</span><span class="o">=</span><span class="n">QLineEdit</span><span class="p">(</span><span class="s1">&#39;100.0&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DmaxLineEdit</span><span class="o">.</span><span class="n">returnPressed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">applyMooresAC</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataPlotLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DmaxLineEdit</span><span class="p">,</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
        <span class="n">col</span><span class="o">+=</span><span class="mi">1</span>
        <span class="n">NrLabel</span><span class="o">=</span><span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;Nr&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataPlotLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">NrLabel</span><span class="p">,</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
        <span class="n">col</span><span class="o">+=</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NrLineEdit</span><span class="o">=</span><span class="n">QLineEdit</span><span class="p">(</span><span class="s1">&#39;101&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataPlotLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NrLineEdit</span><span class="p">,</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NrLineEdit</span><span class="o">.</span><span class="n">returnPressed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">applyMooresAC</span><span class="p">)</span>
        <span class="n">col</span><span class="o">+=</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plotPDDFPushButton</span><span class="o">=</span><span class="n">QPushButton</span><span class="p">(</span><span class="s1">&#39;Plot PDDF&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plotPDDFPushButton</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plotPDDF</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataPlotLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plotPDDFPushButton</span><span class="p">,</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
        
        <span class="n">row</span><span class="o">+=</span><span class="mi">1</span>
        <span class="n">col</span><span class="o">=</span><span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataPlotWidget</span><span class="o">=</span><span class="n">PlotWidget</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataPlotWidget</span><span class="o">.</span><span class="n">setXLabel</span><span class="p">(</span><span class="s1">&#39;Q&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataPlotWidget</span><span class="o">.</span><span class="n">setYLabel</span><span class="p">(</span><span class="s1">&#39;Intensity&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataPlotLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataPlotWidget</span><span class="p">,</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">,</span><span class="n">colspan</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">dataPlotDock</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataPlotLayout</span><span class="p">)</span></div>
        
<div class="viewcode-block" id="ASAXS_Widget.create_metaDataPlotDock"><a class="viewcode-back" href="../SAXS_Drive_link.html#ASAXS_widget.ASAXS_Widget.create_metaDataPlotDock">[docs]</a>    <span class="k">def</span> <span class="nf">create_metaDataPlotDock</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates the metaPlotDataDock</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metaDataPlotLayout</span><span class="o">=</span><span class="n">pg</span><span class="o">.</span><span class="n">LayoutWidget</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">row</span><span class="o">=</span><span class="mi">0</span>
        <span class="n">col</span><span class="o">=</span><span class="mi">0</span>
        <span class="n">xAxisLabel</span><span class="o">=</span><span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;X-Axis&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metaDataPlotLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">xAxisLabel</span><span class="p">,</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
        <span class="n">col</span><span class="o">+=</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xAxisComboBox</span><span class="o">=</span><span class="n">QComboBox</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xAxisComboBox</span><span class="o">.</span><span class="n">currentIndexChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataSelectionChanged</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metaDataPlotLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xAxisComboBox</span><span class="p">,</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
        <span class="n">col</span><span class="o">+=</span><span class="mi">2</span>
        <span class="n">yAxisLabel</span><span class="o">=</span><span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;Y-Axis&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metaDataPlotLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">yAxisLabel</span><span class="p">,</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
        <span class="n">col</span><span class="o">+=</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yAxisComboBox</span><span class="o">=</span><span class="n">QComboBox</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yAxisComboBox</span><span class="o">.</span><span class="n">currentIndexChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataSelectionChanged</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metaDataPlotLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yAxisComboBox</span><span class="p">,</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
        <span class="n">col</span><span class="o">+=</span><span class="mi">2</span>
        <span class="n">normLabel</span><span class="o">=</span><span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;Normalized by&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metaDataPlotLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">normLabel</span><span class="p">,</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
        <span class="n">col</span><span class="o">+=</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">normAxisComboBox</span><span class="o">=</span><span class="n">QComboBox</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">normAxisComboBox</span><span class="o">.</span><span class="n">currentIndexChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataSelectionChanged</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metaDataPlotLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">normAxisComboBox</span><span class="p">,</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
        
        <span class="n">row</span><span class="o">+=</span><span class="mi">1</span>
        <span class="n">col</span><span class="o">=</span><span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metaDataPlotWidget</span><span class="o">=</span><span class="n">PlotWidget</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metaDataPlotLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metaDataPlotWidget</span><span class="p">,</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">,</span><span class="n">colspan</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metaDataPlotDock</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metaDataPlotLayout</span><span class="p">)</span></div>
        
        
    <span class="k">def</span> <span class="nf">create_ASAXSCheckPlotDock</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ASAXSCheckPlotLayout</span><span class="o">=</span><span class="n">pg</span><span class="o">.</span><span class="n">LayoutWidget</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">row</span><span class="o">=</span><span class="mi">0</span>
        <span class="n">col</span><span class="o">=</span><span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ASAXSCheckPlotWidget</span><span class="o">=</span><span class="n">PlotWidget</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ASAXSCheckPlotLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ASAXSCheckPlotWidget</span><span class="p">,</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ASAXSCheckPlotDock</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ASAXSCheckPlotLayout</span><span class="p">)</span>
        
        
<div class="viewcode-block" id="ASAXS_Widget.initialize_metaDataPlotDock"><a class="viewcode-back" href="../SAXS_Drive_link.html#ASAXS_widget.ASAXS_Widget.initialize_metaDataPlotDock">[docs]</a>    <span class="k">def</span> <span class="nf">initialize_metaDataPlotDock</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize metaDataPlotDock</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xAxisComboBox</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yAxisComboBox</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">normAxisComboBox</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xAxisComboBox</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="s1">&#39;None&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">yAxisComboBox</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="s1">&#39;None&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">normAxisComboBox</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="s1">&#39;None&#39;</span><span class="p">)</span></div>
        
        
        
<div class="viewcode-block" id="ASAXS_Widget.applyMooresAC"><a class="viewcode-back" href="../SAXS_Drive_link.html#ASAXS_widget.ASAXS_Widget.applyMooresAC">[docs]</a>    <span class="k">def</span> <span class="nf">applyMooresAC</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Apply Moore&#39;s autocorrelation function operated smoothing</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mooreACSmoothingCheckBox</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">smoothCheckBox</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">dmax</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DmaxLineEdit</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
            <span class="n">Nr</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NrLineEdit</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">fname</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fnames</span><span class="p">):</span>
                <span class="n">r</span><span class="p">,</span><span class="n">pr</span><span class="p">,</span><span class="n">dpr</span><span class="p">,</span><span class="n">q</span><span class="p">,</span><span class="n">iqc</span><span class="o">=</span><span class="n">calc_prm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="s1">&#39;x&#39;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="s1">&#39;yraw&#39;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="s1">&#39;yerr&#39;</span><span class="p">],</span><span class="n">dmax</span><span class="o">=</span><span class="n">dmax</span><span class="p">,</span><span class="n">Nr</span><span class="o">=</span><span class="n">Nr</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="s1">&#39;r&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">r</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="s1">&#39;pr&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">pr</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="s1">&#39;pr_err&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">dpr</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="s1">&#39;y&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">iqc</span>
<span class="c1">#                res=self.dataPlotWidget.add_data(self.data[fname][&#39;x&#39;],self.data[fname][&#39;CF&#39;]*self.data[fname][&#39;y&#39;]/self.data[fname][&#39;Thickness&#39;],name=self.datanames[i],fit=True)</span>
<span class="c1">#            self.dataPlotWidget.Plot(self.datanames)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">fname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fnames</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="s1">&#39;r&#39;</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="s1">&#39;pr&#39;</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="s1">&#39;y&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="s1">&#39;yraw&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataSelectionChanged</span><span class="p">()</span></div>
    
<div class="viewcode-block" id="ASAXS_Widget.plotPDDF"><a class="viewcode-back" href="../SAXS_Drive_link.html#ASAXS_widget.ASAXS_Widget.plotPDDF">[docs]</a>    <span class="k">def</span> <span class="nf">plotPDDF</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plots the moore&#39;s autocorrelation function of the selected data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">=</span><span class="n">pg</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">fname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fnames</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="s1">&#39;r&#39;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="s1">&#39;pr&#39;</span><span class="p">],</span><span class="n">pen</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
        <span class="c1">#pg.plot(self.data[self.fnames[0]][&#39;r&#39;],self.data[self.fnames[0]][&#39;pr&#39;],pen=pg.mkPen(&#39;r&#39;,width=2))</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">QMessageBox</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;Data error&#39;</span><span class="p">,</span><span class="s1">&#39;Please select Moore</span><span class="se">\&#39;</span><span class="s1">s autocorrelation first&#39;</span><span class="p">,</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span></div>
        
<div class="viewcode-block" id="ASAXS_Widget.smoothData"><a class="viewcode-back" href="../SAXS_Drive_link.html#ASAXS_widget.ASAXS_Widget.smoothData">[docs]</a>    <span class="k">def</span> <span class="nf">smoothData</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Smooth the selected data with Savitizky-Golay method</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">smoothCheckBox</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mooreACSmoothingCheckBox</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">window</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">windowSpinBox</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
            <span class="n">degree</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">polyDegSpinBox</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">fname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fnames</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="s1">&#39;y&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">savgol_filter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="s1">&#39;yraw&#39;</span><span class="p">],</span><span class="n">window</span><span class="p">,</span><span class="n">degree</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">fname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fnames</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="s1">&#39;y&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="s1">&#39;yraw&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataSelectionChanged</span><span class="p">()</span></div>
                
<div class="viewcode-block" id="ASAXS_Widget.windowChanged"><a class="viewcode-back" href="../SAXS_Drive_link.html#ASAXS_widget.ASAXS_Widget.windowChanged">[docs]</a>    <span class="k">def</span> <span class="nf">windowChanged</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Changes the window size for smoothing</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">polyDegSpinBox</span><span class="o">.</span><span class="n">setMaximum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">windowSpinBox</span><span class="o">.</span><span class="n">value</span><span class="p">()</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">smoothData</span><span class="p">()</span></div>
        
<div class="viewcode-block" id="ASAXS_Widget.polyDegreeChanged"><a class="viewcode-back" href="../SAXS_Drive_link.html#ASAXS_widget.ASAXS_Widget.polyDegreeChanged">[docs]</a>    <span class="k">def</span> <span class="nf">polyDegreeChanged</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Changes the degree of polynomial for smoothing</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">smoothData</span><span class="p">()</span></div>
        
<div class="viewcode-block" id="ASAXS_Widget.create_ASAXSPlotDock"><a class="viewcode-back" href="../SAXS_Drive_link.html#ASAXS_widget.ASAXS_Widget.create_ASAXSPlotDock">[docs]</a>    <span class="k">def</span> <span class="nf">create_ASAXSPlotDock</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This dock holds the plots of different scattering contributions.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">splitter</span><span class="o">=</span><span class="n">QSplitter</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">Horizontal</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ASAXSCompLayout</span><span class="o">=</span><span class="n">pg</span><span class="o">.</span><span class="n">LayoutWidget</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ASAXSPlotLayout</span><span class="o">=</span><span class="n">pg</span><span class="o">.</span><span class="n">LayoutWidget</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">splitter</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ASAXSCompLayout</span><span class="p">)</span>
        <span class="n">splitter</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ASAXSPlotLayout</span><span class="p">)</span>
        <span class="n">row</span><span class="o">=</span><span class="mi">0</span>
        <span class="n">col</span><span class="o">=</span><span class="mi">0</span>
        <span class="n">directComponentLabel</span><span class="o">=</span><span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;Direct components&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ASAXSCompLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">directComponentLabel</span><span class="p">,</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
        
        <span class="n">row</span><span class="o">=</span><span class="mi">1</span>
        <span class="n">col</span><span class="o">=</span><span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">directComponentListWidget</span><span class="o">=</span><span class="n">QListWidget</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">directComponentListWidget</span><span class="o">.</span><span class="n">setSelectionMode</span><span class="p">(</span><span class="n">QAbstractItemView</span><span class="o">.</span><span class="n">ExtendedSelection</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ASAXSCompLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">directComponentListWidget</span><span class="p">,</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
        
        <span class="n">row</span><span class="o">=</span><span class="mi">2</span>
        <span class="n">crossComponentLabel</span><span class="o">=</span><span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;Cross components&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ASAXSCompLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">crossComponentLabel</span><span class="p">,</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
        
        <span class="n">row</span><span class="o">=</span><span class="mi">3</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">crossComponentListWidget</span><span class="o">=</span><span class="n">QListWidget</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">crossComponentListWidget</span><span class="o">.</span><span class="n">setSelectionMode</span><span class="p">(</span><span class="n">QAbstractItemView</span><span class="o">.</span><span class="n">ExtendedSelection</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ASAXSCompLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">crossComponentListWidget</span><span class="p">,</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
        
        <span class="n">row</span><span class="o">=</span><span class="mi">0</span>
        <span class="n">col</span><span class="o">=</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">directComponentPlotWidget</span><span class="o">=</span><span class="n">PlotWidget</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">directComponentPlotWidget</span><span class="o">.</span><span class="n">setXLabel</span><span class="p">(</span><span class="s1">&#39;Q&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">directComponentPlotWidget</span><span class="o">.</span><span class="n">setYLabel</span><span class="p">(</span><span class="s1">&#39;Intensity&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ASAXSPlotLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">directComponentPlotWidget</span><span class="p">,</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">,</span><span class="n">rowspan</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        
        <span class="n">row</span><span class="o">=</span><span class="mi">2</span>
        <span class="n">col</span><span class="o">=</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">crossComponentPlotWidget</span><span class="o">=</span><span class="n">PlotWidget</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">crossComponentPlotWidget</span><span class="o">.</span><span class="n">setXLabel</span><span class="p">(</span><span class="s1">&#39;Q&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">crossComponentPlotWidget</span><span class="o">.</span><span class="n">setYLabel</span><span class="p">(</span><span class="s1">&#39;Intensity&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ASAXSPlotLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">crossComponentPlotWidget</span><span class="p">,</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">,</span><span class="n">rowspan</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">directComponentListWidget</span><span class="o">.</span><span class="n">itemSelectionChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">directComponentSelectionChanged</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">crossComponentListWidget</span><span class="o">.</span><span class="n">itemSelectionChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">crossComponentSelectionChanged</span><span class="p">)</span>
        
        
        
        <span class="c1">#self.ASAXSPlotWidget=PlotWidget(self)</span>
        <span class="c1">#self.ASAXSPlotWidget.setXLabel(&#39;Q&#39;,fontsize=5)</span>
        <span class="c1">#self.ASAXSPlotWidget.setYLabel(&#39;Intensity&#39;,fontsize=5)</span>
        <span class="c1">#self.ASAXSPlotLayout.addWidget(self.ASAXSPlotWidget,row=row,col=col)        </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ASAXSPlotDock</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">splitter</span><span class="p">)</span></div>
        
        
        
<div class="viewcode-block" id="ASAXS_Widget.create_edgePlotDock"><a class="viewcode-back" href="../SAXS_Drive_link.html#ASAXS_widget.ASAXS_Widget.create_edgePlotDock">[docs]</a>    <span class="k">def</span> <span class="nf">create_edgePlotDock</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This dock holds the plots for scattering factors at the selected energy edge</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edgePlotLayout</span><span class="o">=</span><span class="n">pg</span><span class="o">.</span><span class="n">LayoutWidget</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">row</span><span class="o">=</span><span class="mi">0</span>
        <span class="n">col</span><span class="o">=</span><span class="mi">0</span>
        <span class="n">EminLabel</span><span class="o">=</span><span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;E-min (keV)&#39;</span><span class="p">)</span>
        <span class="n">EmaxLabel</span><span class="o">=</span><span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;E-max (keV)&#39;</span><span class="p">)</span>
        <span class="n">EstepsLabel</span><span class="o">=</span><span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;# of points&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EminLineEdit</span><span class="o">=</span><span class="n">QLineEdit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EmaxLineEdit</span><span class="o">=</span><span class="n">QLineEdit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EstepsLineEdit</span><span class="o">=</span><span class="n">QLineEdit</span><span class="p">(</span><span class="s1">&#39;1000&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edgePlotLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">EminLabel</span><span class="p">,</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
        <span class="n">col</span><span class="o">+=</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edgePlotLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">EminLineEdit</span><span class="p">,</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EminLineEdit</span><span class="o">.</span><span class="n">returnPressed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataSelectionChanged</span><span class="p">)</span>
        <span class="n">col</span><span class="o">+=</span><span class="mi">1</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">edgePlotLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">EmaxLabel</span><span class="p">,</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
        <span class="n">col</span><span class="o">+=</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edgePlotLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">EmaxLineEdit</span><span class="p">,</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EmaxLineEdit</span><span class="o">.</span><span class="n">returnPressed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataSelectionChanged</span><span class="p">)</span>
        <span class="n">col</span><span class="o">+=</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edgePlotLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">EstepsLabel</span><span class="p">,</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
        <span class="n">col</span><span class="o">+=</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edgePlotLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">EstepsLineEdit</span><span class="p">,</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EstepsLineEdit</span><span class="o">.</span><span class="n">returnPressed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataSelectionChanged</span><span class="p">)</span>
        <span class="n">row</span><span class="o">+=</span><span class="mi">1</span>
        <span class="n">col</span><span class="o">=</span><span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edgePlotWidget</span><span class="o">=</span><span class="n">PlotWidget</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edgePlotWidget</span><span class="o">.</span><span class="n">lineWidthLineEdit</span><span class="o">.</span><span class="n">returnPressed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataSelectionChanged</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edgePlotWidget</span><span class="o">.</span><span class="n">pointSizeLineEdit</span><span class="o">.</span><span class="n">returnPressed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataSelectionChanged</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edgePlotWidget</span><span class="o">.</span><span class="n">pointSizeLineEdit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;0&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edgePlotWidget</span><span class="o">.</span><span class="n">setXLabel</span><span class="p">(</span><span class="s1">&#39;Energy (keV)&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edgePlotWidget</span><span class="o">.</span><span class="n">setYLabel</span><span class="p">(</span><span class="s1">&#39;Scattering factors (el/Atom)&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edgePlotLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edgePlotWidget</span><span class="p">,</span><span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">,</span><span class="n">colspan</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">edgePlotDock</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edgePlotLayout</span><span class="p">)</span></div>
        
        
<div class="viewcode-block" id="ASAXS_Widget.interpolate_data"><a class="viewcode-back" href="../SAXS_Drive_link.html#ASAXS_widget.ASAXS_Widget.interpolate_data">[docs]</a>    <span class="k">def</span> <span class="nf">interpolate_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Interpolates all the selected data with the common q values</span>
<span class="sd">        Npt=No. of common q-values on which interpolated values will be calculated</span>
<span class="sd">        kind=&#39;linear&#39;,&#39;cubic&#39;...please check the documentation of scipy.interpolate.interp1d for more options</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">qmin</span><span class="o">=</span><span class="mf">0.0</span>
        <span class="n">qmax</span><span class="o">=</span><span class="mf">1e15</span>
        
        <span class="c1">#For getting the appropriate qmin and qmax of the interpolated data</span>
        <span class="c1">#for item in self.dataListWidget.selectedItems():</span>
        <span class="k">for</span> <span class="n">fname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fnames</span><span class="p">:</span>
            <span class="c1">#dataname, fname=item.text().split(&#39;: &#39;)</span>
            <span class="n">tmin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="s1">&#39;x&#39;</span><span class="p">])</span>
            <span class="n">tmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="s1">&#39;x&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">tmin</span><span class="o">&gt;</span><span class="n">qmin</span><span class="p">:</span>
                <span class="n">qmin</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">tmin</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">tmax</span><span class="o">&lt;</span><span class="n">qmax</span><span class="p">:</span>
                <span class="n">qmax</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">tmax</span><span class="p">)</span>                
        <span class="bp">self</span><span class="o">.</span><span class="n">qintp</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">qmin</span><span class="p">,</span><span class="n">qmax</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fnames</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;x&#39;</span><span class="p">]))</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataListWidget</span><span class="o">.</span><span class="n">selectedItems</span><span class="p">():</span>
            <span class="n">dataname</span><span class="p">,</span> <span class="n">fname</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;: &#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="s1">&#39;xintp&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">qintp</span>
            <span class="c1">#if self.xrfBkgCheckBox.isChecked():</span>
            <span class="c1">#    fun=interp1d(self.data[fname][&#39;x&#39;],self.data[fname][&#39;y-flb&#39;],kind=kind) #Calibration factor and thickness no#rmalization are already applied</span>
            <span class="c1">#else:</span>
            <span class="n">fun</span><span class="o">=</span><span class="n">interp1d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="s1">&#39;x&#39;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="s1">&#39;CF&#39;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="s1">&#39;y&#39;</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="s1">&#39;xrf_bkg&#39;</span><span class="p">])</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="s1">&#39;Thickness&#39;</span><span class="p">],</span><span class="n">kind</span><span class="o">=</span><span class="n">kind</span><span class="p">)</span>
            <span class="n">funerr</span><span class="o">=</span><span class="n">interp1d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="s1">&#39;x&#39;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="s1">&#39;CF&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="s1">&#39;yerr&#39;</span><span class="p">]</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="s1">&#39;Thickness&#39;</span><span class="p">],</span><span class="n">kind</span><span class="o">=</span><span class="n">kind</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="s1">&#39;yintp&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">fun</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qintp</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="s1">&#39;yintperr&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">funerr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qintp</span><span class="p">)</span></div>
            
<div class="viewcode-block" id="ASAXS_Widget.get_f1_f2"><a class="viewcode-back" href="../SAXS_Drive_link.html#ASAXS_widget.ASAXS_Widget.get_f1_f2">[docs]</a>    <span class="k">def</span> <span class="nf">get_f1_f2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">element</span><span class="p">,</span><span class="n">energy</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Obtains f1 and f2 either from NIST table or Henke&#39;s function with element=element symbol and energy in keV</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delE</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">delELineEdit</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">delE</span><span class="o">&gt;</span><span class="mf">1e-4</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">energy</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">energy</span><span class="p">)</span> <span class="ow">is</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
                <span class="n">f1</span><span class="o">=</span><span class="p">[]</span>
                <span class="n">f2</span><span class="o">=</span><span class="p">[]</span>
                <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">energy</span><span class="p">:</span>
                    <span class="n">evals</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">e</span><span class="o">-</span><span class="mi">5</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">delE</span><span class="p">,</span><span class="n">e</span><span class="o">+</span><span class="mi">5</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">delE</span><span class="p">,</span><span class="mf">0.0001</span><span class="p">)</span>
                    <span class="n">calc_f1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xrdb</span><span class="o">.</span><span class="n">f1_chantler</span><span class="p">(</span><span class="n">element</span><span class="o">=</span><span class="n">element</span><span class="p">,</span> <span class="n">energy</span><span class="o">=</span><span class="n">evals</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">smoothing</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                    <span class="n">calc_f2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xrdb</span><span class="o">.</span><span class="n">f2_chantler</span><span class="p">(</span><span class="n">element</span><span class="o">=</span><span class="n">element</span><span class="p">,</span> <span class="n">energy</span><span class="o">=</span><span class="n">evals</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">smoothing</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                    <span class="n">kern</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">evals</span><span class="o">-</span><span class="n">e</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="mf">2.0</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">delE</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">delE</span>
                    <span class="n">ksum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">kern</span><span class="p">)</span>
                    <span class="n">f1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">kern</span><span class="o">*</span><span class="n">calc_f1</span><span class="p">)</span><span class="o">/</span><span class="n">ksum</span><span class="p">)</span>
                    <span class="n">f2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">kern</span><span class="o">*</span><span class="n">calc_f2</span><span class="p">)</span><span class="o">/</span><span class="n">ksum</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">f1</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">f2</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">e</span><span class="o">=</span><span class="n">energy</span>
                <span class="n">evals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">e</span> <span class="o">-</span> <span class="mi">5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">delE</span><span class="p">,</span> <span class="n">e</span> <span class="o">+</span> <span class="mi">5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">delE</span><span class="p">,</span> <span class="mf">0.0001</span><span class="p">)</span>
                <span class="n">calc_f1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xrdb</span><span class="o">.</span><span class="n">f1_chantler</span><span class="p">(</span><span class="n">element</span><span class="o">=</span><span class="n">element</span><span class="p">,</span> <span class="n">energy</span><span class="o">=</span><span class="n">evals</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">smoothing</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">calc_f2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xrdb</span><span class="o">.</span><span class="n">f2_chantler</span><span class="p">(</span><span class="n">element</span><span class="o">=</span><span class="n">element</span><span class="p">,</span> <span class="n">energy</span><span class="o">=</span><span class="n">evals</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">smoothing</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">kern</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">evals</span> <span class="o">-</span> <span class="n">e</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="mf">2.0</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">delE</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">delE</span>
                <span class="n">ksum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">kern</span><span class="p">)</span>
                <span class="n">f1</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">kern</span> <span class="o">*</span> <span class="n">calc_f1</span><span class="p">)</span> <span class="o">/</span> <span class="n">ksum</span>
                <span class="n">f2</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">kern</span> <span class="o">*</span> <span class="n">calc_f2</span><span class="p">)</span> <span class="o">/</span> <span class="n">ksum</span>
                <span class="k">return</span> <span class="n">f1</span><span class="p">,</span> <span class="n">f2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataBase</span><span class="o">==</span><span class="s1">&#39;NIST&#39;</span><span class="p">:</span>
                <span class="n">f1</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">xrdb</span><span class="o">.</span><span class="n">f1_chantler</span><span class="p">(</span><span class="n">element</span><span class="o">=</span><span class="n">element</span><span class="p">,</span><span class="n">energy</span><span class="o">=</span><span class="n">energy</span><span class="o">*</span><span class="mi">1000</span><span class="p">,</span><span class="n">smoothing</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">f2</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">xrdb</span><span class="o">.</span><span class="n">f2_chantler</span><span class="p">(</span><span class="n">element</span><span class="o">=</span><span class="n">element</span><span class="p">,</span><span class="n">energy</span><span class="o">=</span><span class="n">energy</span><span class="o">*</span><span class="mi">1000</span><span class="p">,</span><span class="n">smoothing</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">f1</span><span class="o">=</span><span class="nb">eval</span><span class="p">(</span><span class="s1">&#39;-pdt.</span><span class="si">%s</span><span class="s1">.number+pdt.</span><span class="si">%s</span><span class="s1">.xray.scattering_factors(energy=energy)[0]&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">element</span><span class="p">,</span><span class="n">element</span><span class="p">))</span>
                <span class="n">f2</span><span class="o">=</span><span class="nb">eval</span><span class="p">(</span><span class="s1">&#39;pdt.</span><span class="si">%s</span><span class="s1">.xray.scattering_factors(energy=energy)[1]&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">element</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">f1</span><span class="p">,</span> <span class="n">f2</span></div>
    
<div class="viewcode-block" id="ASAXS_Widget.checkData"><a class="viewcode-back" href="../SAXS_Drive_link.html#ASAXS_widget.ASAXS_Widget.checkData">[docs]</a>    <span class="k">def</span> <span class="nf">checkData</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Do initial check on the selected data for further ASAXS analysis</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataListWidget</span><span class="o">.</span><span class="n">selectedItems</span><span class="p">())</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">interpolate_data</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prepareData</span><span class="p">()</span>
            <span class="n">dataChk</span><span class="o">=</span><span class="p">[]</span>
            <span class="n">errChk</span><span class="o">=</span><span class="p">[]</span>
            <span class="n">f1val</span><span class="o">=</span><span class="p">[]</span>
            <span class="n">energy</span><span class="o">=</span><span class="p">[]</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataListWidget</span><span class="o">.</span><span class="n">selectedItems</span><span class="p">():</span>
                <span class="n">dataname</span><span class="p">,</span> <span class="n">fname</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;: &#39;</span><span class="p">)</span>
                <span class="n">dataChk</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="s1">&#39;yintp&#39;</span><span class="p">])</span>
                <span class="n">errChk</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="s1">&#39;yintperr&#39;</span><span class="p">])</span>
                <span class="n">f1val</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="s1">&#39;f1&#39;</span><span class="p">])</span>
                <span class="n">energy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="s1">&#39;Energy&#39;</span><span class="p">])</span>
            <span class="n">dataChk</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dataChk</span><span class="p">)</span>
            <span class="n">errChk</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">errChk</span><span class="p">)</span>
            <span class="n">dataChk</span><span class="o">=</span><span class="n">dataChk</span>
            <span class="n">errChk</span><span class="o">=</span><span class="n">errChk</span>
            <span class="n">f1val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">f1val</span><span class="p">)</span>
            <span class="n">energy</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">energy</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pdata</span><span class="o">=</span><span class="p">[[</span><span class="n">energy</span><span class="p">,</span><span class="n">f1val</span><span class="p">,</span><span class="n">dataChk</span><span class="p">[:,</span><span class="n">i</span><span class="p">],</span><span class="n">errChk</span><span class="p">[:,</span><span class="n">i</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dataChk</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
            <span class="c1">#print(self.pdata[0][0],self.pdata[0][1],self.pdata[0][2]/self.pdata[0][2][0])#/self.pdata[0][2][0])</span>
            <span class="c1">#print(len(self.pdata[0][0]), len(self.pdata[0][1]), len(self.pdata[0][2]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dataCheckWidget</span><span class="o">=</span><span class="n">pg</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pdata</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">pdata</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">pdata</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">pen</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">symbol</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">checkDataSpinBox</span><span class="o">.</span><span class="n">setMinimum</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">checkDataSpinBox</span><span class="o">.</span><span class="n">setMaximum</span><span class="p">(</span><span class="n">dataChk</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">checkDataSpinBox</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>            
            <span class="bp">self</span><span class="o">.</span><span class="n">checkDataLocLine</span><span class="o">=</span><span class="n">pg</span><span class="o">.</span><span class="n">InfiniteLine</span><span class="p">(</span><span class="n">pos</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">qintp</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">pen</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dataPlotWidget</span><span class="o">.</span><span class="n">plotWidget</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">checkDataLocLine</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">checkDataSpinBox</span><span class="o">.</span><span class="n">valueChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_dataCheckPlot</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_dataCheckPlot</span><span class="p">()</span></div>
            
<div class="viewcode-block" id="ASAXS_Widget.saveCheckData"><a class="viewcode-back" href="../SAXS_Drive_link.html#ASAXS_widget.ASAXS_Widget.saveCheckData">[docs]</a>    <span class="k">def</span> <span class="nf">saveCheckData</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save the checked data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">fname</span><span class="o">=</span><span class="n">QFileDialog</span><span class="o">.</span><span class="n">getSaveFileName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">caption</span><span class="o">=</span><span class="s1">&#39;Save checked data as&#39;</span><span class="p">,</span><span class="n">directory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dataDir</span><span class="p">,</span><span class="nb">filter</span><span class="o">=</span><span class="s1">&#39;Text files (*.txt)&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">fname</span> <span class="o">!=</span><span class="s1">&#39;&#39;</span><span class="p">:</span>
                <span class="n">i</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">checkDataSpinBox</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
                <span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">pdata</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">pdata</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">pdata</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">pdata</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">3</span><span class="p">]))</span><span class="o">.</span><span class="n">T</span>
                <span class="n">header</span><span class="o">=</span><span class="s1">&#39;Data extracted at Q=</span><span class="si">%.6f</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">qintp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">header</span><span class="o">+=</span><span class="s1">&#39;col_names=[&quot;Energy&quot;,&quot;f1&quot;,&quot;Intensity&quot;,&quot;Intensity_err&quot;]&#39;</span>
                <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span><span class="n">data</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="n">header</span><span class="p">,</span><span class="n">comments</span><span class="o">=</span><span class="s1">&#39;#&#39;</span><span class="p">)</span>            
        <span class="k">except</span><span class="p">:</span>
            <span class="n">QMessageBox</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;Data error&#39;</span><span class="p">,</span><span class="s1">&#39;No checked data to be saved. Please click Check Data button first&#39;</span><span class="p">,</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span></div>
        
        
<div class="viewcode-block" id="ASAXS_Widget.update_dataCheckPlot"><a class="viewcode-back" href="../SAXS_Drive_link.html#ASAXS_widget.ASAXS_Widget.update_dataCheckPlot">[docs]</a>    <span class="k">def</span> <span class="nf">update_dataCheckPlot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updates the dataCheckplot</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">i</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">checkDataSpinBox</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataCheckWidget</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataCheckWidget</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pdata</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">pdata</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">pdata</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">symbol</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">pen</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataPlotWidget</span><span class="o">.</span><span class="n">plotWidget</span><span class="o">.</span><span class="n">getPlotItem</span><span class="p">()</span><span class="o">.</span><span class="n">ctrl</span><span class="o">.</span><span class="n">logXCheck</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">checkDataLocLine</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qintp</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">checkDataLocLine</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qintp</span><span class="p">[</span><span class="n">i</span><span class="p">])</span></div>
        
        
<div class="viewcode-block" id="ASAXS_Widget.prepareData"><a class="viewcode-back" href="../SAXS_Drive_link.html#ASAXS_widget.ASAXS_Widget.prepareData">[docs]</a>    <span class="k">def</span> <span class="nf">prepareData</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Prepares the selected data for ASAXS splitting i.e.</span>
<span class="sd">        1) Interpolate the all data sets with same q values. SAXS data collection at different energies can bring different q-values</span>
<span class="sd">        2) Calculates the scattering factors f1 and f2 for energies at which the data were collected</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interpolate_data</span><span class="p">()</span>
        <span class="n">element</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elementComboBox</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;: &#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AMatrix</span><span class="o">=</span><span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">BMatrix</span><span class="o">=</span><span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EOff</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">EOffLineEdit</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
        <span class="c1">#self.calc_XRF_baseline()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">minEnergy</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;Energy&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">()])</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataListWidget</span><span class="o">.</span><span class="n">selectedItems</span><span class="p">():</span>
            <span class="n">dataname</span><span class="p">,</span> <span class="n">fname</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;: &#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="s1">&#39;f1&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="s1">&#39;f2&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_f1_f2</span><span class="p">(</span><span class="n">element</span><span class="p">,(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="s1">&#39;Energy&#39;</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">EOff</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="s1">&#39;f1&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="s1">&#39;f1&#39;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span><span class="o">+</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">linearOffsetLineEdit</span><span class="o">.</span><span class="n">text</span><span class="p">())</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="s1">&#39;Energy&#39;</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">minEnergy</span><span class="p">))</span>
            
            <span class="c1">#self.data[fname][&#39;f1&#39;]=self.xrdb.f1_chantler(element=element,energy=(self.data[fname][&#39;Energy&#39;]-self.EOff)*1000)</span>
            <span class="c1">#self.data[fname][&#39;f2&#39;]=self.xrdb.f2_chantler(element=element,energy=(self.data[fname][&#39;Energy&#39;]-self.EOff)*1000)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">AMatrix</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="s1">&#39;f1&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="s1">&#39;f1&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="s1">&#39;f2&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">])</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">BMatrix</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">BMatrix</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">BMatrix</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="s1">&#39;yintp&#39;</span><span class="p">]))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">BMatrix</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">fname</span><span class="p">][</span><span class="s1">&#39;yintp&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AMatrix</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">AMatrix</span><span class="p">)</span></div>
        
    <span class="k">def</span> <span class="nf">ASAXS_split</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1">#try:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ASAXSCalcTypeComboBox</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span><span class="o">==</span><span class="s1">&#39;single&#39;</span><span class="p">:</span>
            <span class="c1">#self.ASAXS_split_1()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ASAXS_split_w_errbars</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ASAXS_split_3</span><span class="p">()</span>
            
        <span class="c1">#self.ASAXS_split_3()</span>
<span class="c1">#        if str(self.ASAXSCalcTypeComboBox.currentText())==&#39;np.linalg.lstsq&#39;:</span>
<span class="c1">#            if len(self.fnames)==3:</span>
<span class="c1">#                self.ASAXS_split_0()</span>
<span class="c1">#            else:</span>
<span class="c1">#                #self.ASAXS_split_1()</span>
<span class="c1">#                self.ASAXS_split_3()</span>
<span class="c1">#        else:</span>
<span class="c1">#            if len(self.fnames)==3:</span>
<span class="c1">#                self.ASAXS_split_0()</span>
<span class="c1">#            else:</span>
<span class="c1">#                self.ASAXS_split_2()</span>
<span class="c1">#        #except:</span>
        <span class="c1">#    QMessageBox.warning(self,&#39;Selection error&#39;,&#39;Please select atleast three data sets to calculate the components&#39;,QMessageBox.Ok)</span>
        
            
<div class="viewcode-block" id="ASAXS_Widget.ASAXS_split_0"><a class="viewcode-back" href="../SAXS_Drive_link.html#ASAXS_widget.ASAXS_Widget.ASAXS_split_0">[docs]</a>    <span class="k">def</span> <span class="nf">ASAXS_split_0</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This calculates scattering compononents out</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prepareData</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">XMatrix</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qintp</span><span class="p">)):</span>
            <span class="n">x</span><span class="o">=</span><span class="n">solve</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">AMatrix</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">BMatrix</span><span class="p">[:,</span><span class="n">i</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">XMatrix</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">XMatrix</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">XMatrix</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ASAXSPlotWidget</span><span class="o">.</span><span class="n">add_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qintp</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">XMatrix</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;SAXS-term&#39;</span><span class="p">)</span>
        <span class="c1">#if np.all(self.XMatrix[:,1]&gt;0):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ASAXSPlotWidget</span><span class="o">.</span><span class="n">add_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qintp</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">XMatrix</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Cross-term&#39;</span><span class="p">)</span>
        <span class="c1">#else:</span>
        <span class="c1">#    QMessageBox.warning(self,&#39;Negative Log error&#39;,&#39;Cross terms are all negative so plotting the -ve of cross terms&#39;,QMessageBox.Ok)</span>
        <span class="c1">#    self.ASAXSPlotWidget.add_data(self.qintp,-self.XMatrix[:,1],name=&#39;neg Cross-term&#39;)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ASAXSPlotWidget</span><span class="o">.</span><span class="n">add_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qintp</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">XMatrix</span><span class="p">[:,</span><span class="mi">2</span><span class="p">],</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Resonant-term&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ASAXSPlotWidget</span><span class="o">.</span><span class="n">add_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qintp</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">AMatrix</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]],</span><span class="bp">self</span><span class="o">.</span><span class="n">XMatrix</span><span class="o">.</span><span class="n">T</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Total&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_ASAXSPlot</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">saveASAXSPushButton</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span></div>
            
            
<div class="viewcode-block" id="ASAXS_Widget.ASAXS_split_1"><a class="viewcode-back" href="../SAXS_Drive_link.html#ASAXS_widget.ASAXS_Widget.ASAXS_split_1">[docs]</a>    <span class="k">def</span> <span class="nf">ASAXS_split_1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This calculates scattering compononents out</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataListWidget</span><span class="o">.</span><span class="n">selectedItems</span><span class="p">())</span><span class="o">&gt;=</span><span class="mi">3</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prepareData</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">XMatrix</span><span class="o">=</span><span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qintp</span><span class="p">)):</span>
                <span class="n">x</span><span class="p">,</span><span class="n">residuals</span><span class="p">,</span><span class="n">rank</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="n">lstsq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">AMatrix</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">BMatrix</span><span class="p">[:,</span><span class="n">i</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">XMatrix</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">XMatrix</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">XMatrix</span><span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">directComponentPlotWidget</span><span class="o">.</span><span class="n">add_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qintp</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">XMatrix</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;SAXS-term&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">directComponentPlotWidget</span><span class="o">.</span><span class="n">add_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qintp</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">XMatrix</span><span class="p">[:,</span><span class="mi">2</span><span class="p">],</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Resonant-term&#39;</span><span class="p">)</span>
            <span class="n">tot</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">AMatrix</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]],</span><span class="bp">self</span><span class="o">.</span><span class="n">XMatrix</span><span class="o">.</span><span class="n">T</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">directComponentPlotWidget</span><span class="o">.</span><span class="n">add_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qintp</span><span class="p">,</span><span class="n">tot</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Total&#39;</span><span class="p">)</span>           
            <span class="bp">self</span><span class="o">.</span><span class="n">directComponentPlotWidget</span><span class="o">.</span><span class="n">add_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qintp</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fnames</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;yintp&#39;</span><span class="p">],</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Data_</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">datanames</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">directComponentListWidget</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">crossComponentListWidget</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">directComponentListWidget</span><span class="o">.</span><span class="n">itemSelectionChanged</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">crossComponentListWidget</span><span class="o">.</span><span class="n">itemSelectionChanged</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">directComponentListWidget</span><span class="o">.</span><span class="n">addItems</span><span class="p">([</span><span class="s1">&#39;SAXS-term&#39;</span><span class="p">,</span><span class="s1">&#39;Resonant-term&#39;</span><span class="p">,</span><span class="s1">&#39;Total&#39;</span><span class="p">,</span><span class="s1">&#39;Data_</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">datanames</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">crossComponentListWidget</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="s1">&#39;Cross-term&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">crossComponentPlotWidget</span><span class="o">.</span><span class="n">add_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qintp</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">XMatrix</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Cross-term&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="o">=</span><span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="s1">&#39;SAXS-term&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">XMatrix</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="s1">&#39;Resonant-term&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">XMatrix</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="s1">&#39;Cross-term&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">XMatrix</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="s1">&#39;Total&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">tot</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="s1">&#39;Data_</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">datanames</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fnames</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;yintp&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_ASAXSPlot</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">saveASAXSPushButton</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">directComponentListWidget</span><span class="o">.</span><span class="n">itemSelectionChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">directComponentSelectionChanged</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">crossComponentListWidget</span><span class="o">.</span><span class="n">itemSelectionChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">crossComponentSelectionChanged</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">directComponentListWidget</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">setSelected</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">crossComponentListWidget</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">setSelected</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">#self.saveASAXSPushButton.setEnabled(True)</span>
            <span class="n">QMessageBox</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;Data Error&#39;</span><span class="p">,</span><span class="s1">&#39;Please select three or more data sets to do the calculation&#39;</span><span class="p">,</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span></div>


<div class="viewcode-block" id="ASAXS_Widget.lmfit_residual"><a class="viewcode-back" href="../SAXS_Drive_link.html#ASAXS_widget.ASAXS_Widget.lmfit_residual">[docs]</a>    <span class="k">def</span> <span class="nf">lmfit_residual</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates the residual for lmfit to obtain the errorbars in the parameters</span>
<span class="sd">        :param param:</span>
<span class="sd">        :param A: Amatrix</span>
<span class="sd">        :param B: BMatrix</span>
<span class="sd">        :return: residual</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;x1&#39;</span><span class="p">],</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;x2&#39;</span><span class="p">],</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;x3&#39;</span><span class="p">]])</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="n">x</span><span class="p">)</span><span class="o">-</span><span class="n">B</span></div>

    <span class="k">def</span> <span class="nf">lmfit_finderrbars</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">B</span><span class="p">):</span>
        <span class="n">param</span><span class="o">=</span><span class="n">Parameters</span><span class="p">()</span>
        <span class="n">param</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;x1&#39;</span><span class="p">,</span><span class="n">value</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">param</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;x2&#39;</span><span class="p">,</span><span class="n">value</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">param</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;x3&#39;</span><span class="p">,</span><span class="n">value</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">lmfit_minimize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lmfit_residual</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="n">B</span><span class="p">))</span>
        <span class="n">x1</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;x1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
        <span class="n">x1err</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;x1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">stderr</span>
        <span class="n">x2</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;x2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
        <span class="n">x2err</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;x2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">stderr</span>
        <span class="n">x3</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;x3&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
        <span class="n">x3err</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;x3&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">stderr</span>
        <span class="k">return</span> <span class="n">x1</span><span class="p">,</span> <span class="n">x1err</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">x2err</span><span class="p">,</span> <span class="n">x3</span><span class="p">,</span> <span class="n">x3err</span>



<div class="viewcode-block" id="ASAXS_Widget.ASAXS_split_w_errbars"><a class="viewcode-back" href="../SAXS_Drive_link.html#ASAXS_widget.ASAXS_Widget.ASAXS_split_w_errbars">[docs]</a>    <span class="k">def</span> <span class="nf">ASAXS_split_w_errbars</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This calculates scattering compononents out</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dataListWidget</span><span class="o">.</span><span class="n">selectedItems</span><span class="p">())</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prepareData</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">XMatrix</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">XMatrixErr</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qintp</span><span class="p">)):</span>
                <span class="n">x</span><span class="p">,</span> <span class="n">residuals</span><span class="p">,</span> <span class="n">rank</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="n">lstsq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">AMatrix</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">BMatrix</span><span class="p">[:,</span> <span class="n">i</span><span class="p">])</span>
                <span class="n">x1</span><span class="p">,</span> <span class="n">x1err</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">x2err</span><span class="p">,</span> <span class="n">x3</span><span class="p">,</span> <span class="n">x3err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lmfit_finderrbars</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">AMatrix</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">BMatrix</span><span class="p">[:,</span> <span class="n">i</span><span class="p">])</span>
                <span class="n">xn</span><span class="o">=</span><span class="p">[</span><span class="n">x1</span><span class="p">,</span><span class="n">x2</span><span class="p">,</span><span class="n">x3</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">XMatrix</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xn</span><span class="p">)</span>
                <span class="n">xnerr</span><span class="o">=</span><span class="p">[</span><span class="n">x1err</span><span class="p">,</span> <span class="n">x2err</span><span class="p">,</span> <span class="n">x3err</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">XMatrixErr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xnerr</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">XMatrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">XMatrix</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">XMatrixErr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">XMatrixErr</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">directComponentPlotWidget</span><span class="o">.</span><span class="n">add_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qintp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">XMatrix</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">yerr</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">XMatrixErr</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;SAXS-term&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">directComponentPlotWidget</span><span class="o">.</span><span class="n">add_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qintp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">XMatrix</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">yerr</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">XMatrixErr</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Resonant-term&#39;</span><span class="p">)</span>
            <span class="n">tot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">AMatrix</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]],</span> <span class="bp">self</span><span class="o">.</span><span class="n">XMatrix</span><span class="o">.</span><span class="n">T</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">directComponentPlotWidget</span><span class="o">.</span><span class="n">add_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qintp</span><span class="p">,</span> <span class="n">tot</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Total&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">directComponentPlotWidget</span><span class="o">.</span><span class="n">add_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qintp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fnames</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;yintp&#39;</span><span class="p">],</span>
                                                    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Data_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">datanames</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">directComponentListWidget</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">crossComponentListWidget</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">directComponentListWidget</span><span class="o">.</span><span class="n">itemSelectionChanged</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">crossComponentListWidget</span><span class="o">.</span><span class="n">itemSelectionChanged</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">directComponentListWidget</span><span class="o">.</span><span class="n">addItems</span><span class="p">(</span>
                <span class="p">[</span><span class="s1">&#39;SAXS-term&#39;</span><span class="p">,</span> <span class="s1">&#39;Resonant-term&#39;</span><span class="p">,</span> <span class="s1">&#39;Total&#39;</span><span class="p">,</span> <span class="s1">&#39;Data_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">datanames</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">crossComponentListWidget</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="s1">&#39;Cross-term&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">crossComponentPlotWidget</span><span class="o">.</span><span class="n">add_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qintp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">XMatrix</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">yerr</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">XMatrixErr</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Cross-term&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">components</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="s1">&#39;SAXS-term&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">XMatrix</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="s1">&#39;SAXS-term_err&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">XMatrixErr</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="s1">&#39;Resonant-term&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">XMatrix</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="s1">&#39;Resonant-term_err&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">XMatrixErr</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="s1">&#39;Cross-term&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">XMatrix</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="s1">&#39;Cross-term_err&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">XMatrixErr</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="s1">&#39;Total&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tot</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="s1">&#39;Data_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">datanames</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fnames</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;yintp&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_ASAXSPlot</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">saveASAXSPushButton</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">directComponentListWidget</span><span class="o">.</span><span class="n">itemSelectionChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">directComponentSelectionChanged</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">crossComponentListWidget</span><span class="o">.</span><span class="n">itemSelectionChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">crossComponentSelectionChanged</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">directComponentListWidget</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">setSelected</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">crossComponentListWidget</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">setSelected</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># self.saveASAXSPushButton.setEnabled(True)</span>
            <span class="n">QMessageBox</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Data Error&#39;</span><span class="p">,</span> <span class="s1">&#39;Please select three or more data sets to do the calculation&#39;</span><span class="p">,</span>
                                <span class="n">QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span></div>

<div class="viewcode-block" id="ASAXS_Widget.residual"><a class="viewcode-back" href="../SAXS_Drive_link.html#ASAXS_widget.ASAXS_Widget.residual">[docs]</a>    <span class="k">def</span> <span class="nf">residual</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">B</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates the residual for ASAXS_split_2</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">-</span><span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span></div>
            
<div class="viewcode-block" id="ASAXS_Widget.ASAXS_split_2"><a class="viewcode-back" href="../SAXS_Drive_link.html#ASAXS_widget.ASAXS_Widget.ASAXS_split_2">[docs]</a>    <span class="k">def</span> <span class="nf">ASAXS_split_2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This calculates the scattering components by constraining the SAXS and anomalous term to be positive</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fnames</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">3</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prepareData</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">XMatrix</span><span class="o">=</span><span class="p">[]</span>
            <span class="n">cons</span><span class="o">=</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;ineq&#39;</span><span class="p">,</span> <span class="s1">&#39;fun&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]},</span>
                   <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;ineq&#39;</span><span class="p">,</span> <span class="s1">&#39;fun&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]},)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qintp</span><span class="p">)):</span>
                <span class="n">res</span><span class="o">=</span><span class="n">minimize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">residual</span><span class="p">,[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],</span><span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">AMatrix</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">BMatrix</span><span class="p">[:,</span><span class="n">i</span><span class="p">]),</span><span class="n">constraints</span><span class="o">=</span><span class="n">cons</span><span class="p">,</span><span class="n">bounds</span><span class="o">=</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="kc">None</span><span class="p">),(</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span><span class="kc">None</span><span class="p">)))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">XMatrix</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">XMatrix</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">XMatrix</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ASAXSPlotWidget</span><span class="o">.</span><span class="n">add_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qintp</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">XMatrix</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;SAXS-term&#39;</span><span class="p">)</span>
            <span class="c1">#if np.all(self.XMatrix[:,1]&gt;0):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ASAXSPlotWidget</span><span class="o">.</span><span class="n">add_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qintp</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">XMatrix</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Cross-term&#39;</span><span class="p">)</span>
            <span class="c1">#else:</span>
            <span class="c1">#    QMessageBox.warning(self,&#39;Negative Log error&#39;,&#39;Cross terms are all negative so plotting the -ve of cross terms&#39;,QMessageBox.Ok)</span>
            <span class="c1">#    self.ASAXSPlotWidget.add_data(self.qintp,-self.XMatrix[:,1],name=&#39;neg Cross-term&#39;)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ASAXSPlotWidget</span><span class="o">.</span><span class="n">add_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qintp</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">XMatrix</span><span class="p">[:,</span><span class="mi">2</span><span class="p">],</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Resonant-term&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ASAXSPlotWidget</span><span class="o">.</span><span class="n">add_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qintp</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">AMatrix</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]],</span><span class="bp">self</span><span class="o">.</span><span class="n">XMatrix</span><span class="o">.</span><span class="n">T</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Total&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_ASAXSPlot</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">saveASAXSPushButton</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">#self.saveASAXSPushButton.setEnabled(True)</span>
            <span class="n">QMessageBox</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;Data error&#39;</span><span class="p">,</span><span class="s1">&#39;Please select more than three data sets to do the calculation&#39;</span><span class="p">,</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span></div>
            
<div class="viewcode-block" id="ASAXS_Widget.prepareNewData"><a class="viewcode-back" href="../SAXS_Drive_link.html#ASAXS_widget.ASAXS_Widget.prepareNewData">[docs]</a>    <span class="k">def</span> <span class="nf">prepareNewData</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Prepares the selected data for new ASAXS splitting provided by ASAXS_split_3 i.e.</span>
<span class="sd">        1) Interpolate the all data sets with same q values. SAXS data collection at different energies can bring different q-values</span>
<span class="sd">        2) Calculates the scattering factors f1 and f2 for energies at which the data were collected</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interpolate_data</span><span class="p">()</span>
        <span class="c1">#element=str(self.elementComboBox.currentText().split(&#39;: &#39;)[1])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EOff</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">EOffLineEdit</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
        <span class="c1">#self.calc_XRF_baseline()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">minEnergy</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;Energy&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">()])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">elementsLineEdit</span><span class="o">.</span><span class="n">text</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
        <span class="n">fe</span><span class="o">=</span><span class="p">{}</span>
        <span class="n">Ne</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fnames</span><span class="p">)</span>
        <span class="n">Np</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AIndex</span><span class="o">=</span><span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AMatrix</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">Ne</span><span class="p">,</span><span class="n">Np</span><span class="o">+</span><span class="nb">int</span><span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="n">misc</span><span class="o">.</span><span class="n">comb</span><span class="p">(</span><span class="n">Np</span><span class="p">,</span><span class="mi">2</span><span class="p">))))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">BMatrix</span><span class="o">=</span><span class="kc">None</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Ne</span><span class="p">):</span>
            <span class="n">ind</span><span class="o">=</span><span class="mi">0</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Np</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;x&#39;</span><span class="p">:</span>
                    <span class="n">fe</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">f0</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">xrdb</span><span class="o">.</span><span class="n">f0</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="mf">0.0</span><span class="p">)</span>
                    <span class="n">f1</span><span class="p">,</span><span class="n">f2</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_f1_f2</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">[</span><span class="n">i</span><span class="p">],(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fnames</span><span class="p">[</span><span class="n">k</span><span class="p">]][</span><span class="s1">&#39;Energy&#39;</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">EOff</span><span class="p">))</span>
                    <span class="n">fe</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex</span><span class="p">(</span><span class="n">f0</span><span class="o">+</span><span class="n">f1</span><span class="p">,</span><span class="n">f2</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">AMatrix</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="n">ind</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">fe</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span><span class="o">**</span><span class="mi">2</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">AIndex</span><span class="p">[</span><span class="s1">&#39;S_</span><span class="si">%s</span><span class="s1">-</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">[</span><span class="n">i</span><span class="p">])]</span><span class="o">=</span><span class="n">ind</span>
                <span class="n">ind</span><span class="o">+=</span><span class="mi">1</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Np</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">Np</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">AMatrix</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="n">ind</span><span class="p">]</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">fe</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">conjugate</span><span class="p">(</span><span class="n">fe</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">[</span><span class="n">j</span><span class="p">]]))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">AIndex</span><span class="p">[</span><span class="s1">&#39;S_</span><span class="si">%s</span><span class="s1">-</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">[</span><span class="n">j</span><span class="p">])]</span><span class="o">=</span><span class="n">ind</span>
                    <span class="n">ind</span><span class="o">+=</span><span class="mi">1</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">BMatrix</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">BMatrix</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">BMatrix</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fnames</span><span class="p">[</span><span class="n">k</span><span class="p">]][</span><span class="s1">&#39;yintp&#39;</span><span class="p">]))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">BMatrix</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fnames</span><span class="p">[</span><span class="n">k</span><span class="p">]][</span><span class="s1">&#39;yintp&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">directComponentListWidget</span><span class="o">.</span><span class="n">itemSelectionChanged</span><span class="o">.</span><span class="n">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">directComponentSelectionChanged</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">crossComponentListWidget</span><span class="o">.</span><span class="n">itemSelectionChanged</span><span class="o">.</span><span class="n">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">crossComponentSelectionChanged</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">directComponentListWidget</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">crossComponentListWidget</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Np</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">directComponentListWidget</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="s1">&#39;S_</span><span class="si">%s</span><span class="s1">-</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Np</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">Np</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">crossComponentListWidget</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="s1">&#39;S_</span><span class="si">%s</span><span class="s1">-</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">[</span><span class="n">j</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">directComponentListWidget</span><span class="o">.</span><span class="n">itemSelectionChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">directComponentSelectionChanged</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">crossComponentListWidget</span><span class="o">.</span><span class="n">itemSelectionChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">crossComponentSelectionChanged</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Ne</span><span class="p">,</span><span class="n">Np</span></div>
            
<div class="viewcode-block" id="ASAXS_Widget.ASAXS_split_3"><a class="viewcode-back" href="../SAXS_Drive_link.html#ASAXS_widget.ASAXS_Widget.ASAXS_split_3">[docs]</a>    <span class="k">def</span> <span class="nf">ASAXS_split_3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Splits the energy dependent SAXS data into partial scattering factors i.e. contribution of scattering intensity </span>
<span class="sd">        from different elements mentioned in Elements List Widget</span>
<span class="sd">        Please use x if you do not wish to put the element information of the elements other than the edge elements</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fnames</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">3</span><span class="p">:</span>
            <span class="n">Ne</span><span class="p">,</span><span class="n">Np</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prepareNewData</span><span class="p">()</span>
            <span class="n">X</span><span class="o">=</span><span class="p">[]</span>
            <span class="n">tot</span><span class="o">=</span><span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="o">=</span><span class="p">{}</span>
            <span class="n">ans</span><span class="o">=</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Yes</span>
            <span class="n">f1</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">xrdb</span><span class="o">.</span><span class="n">f1_chantler</span><span class="p">(</span><span class="n">element</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">[</span><span class="n">Np</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">energy</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fnames</span><span class="p">[</span><span class="n">k</span><span class="p">]][</span><span class="s1">&#39;Energy&#39;</span><span class="p">]</span><span class="o">*</span><span class="mf">1e3</span><span class="p">,</span><span class="n">smoothing</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Ne</span><span class="p">)]</span>
            <span class="n">ans</span><span class="o">=</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">question</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;Question&#39;</span><span class="p">,</span><span class="s1">&#39;Do you like to look at each individual Q for this analysis?&#39;</span><span class="p">,</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Yes</span><span class="p">,</span> <span class="n">QMessageBox</span><span class="o">.</span><span class="n">No</span><span class="p">)</span>        
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">BMatrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="n">X</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">lstsq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">AMatrix</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">BMatrix</span><span class="p">[:,</span><span class="n">i</span><span class="p">],</span><span class="n">lapack_driver</span><span class="o">=</span><span class="s1">&#39;gelsd&#39;</span><span class="p">,</span><span class="n">check_finite</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">overwrite_a</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">overwrite_b</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">tot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">AMatrix</span><span class="p">,</span><span class="n">X</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>            
                <span class="k">if</span> <span class="n">ans</span><span class="o">==</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Yes</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ASAXSCheckPlotWidget</span><span class="o">.</span><span class="n">add_data</span><span class="p">(</span><span class="n">f1</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">BMatrix</span><span class="p">[:,</span><span class="n">i</span><span class="p">],</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Data&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ASAXSCheckPlotWidget</span><span class="o">.</span><span class="n">add_data</span><span class="p">(</span><span class="n">f1</span><span class="p">,</span><span class="n">tot</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Fit&#39;</span><span class="p">,</span><span class="n">fit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">ASAXSCheckPlotWidget</span><span class="o">.</span><span class="n">Plot</span><span class="p">([</span><span class="s1">&#39;Data&#39;</span><span class="p">,</span><span class="s1">&#39;Fit&#39;</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">raiseDock</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ASAXSCheckPlotDock</span><span class="p">)</span>
<span class="c1">#                    try:</span>
<span class="c1">#                        sdata.setData(f1,self.BMatrix[:,i],pen=None,symbol=&#39;o&#39;)</span>
<span class="c1">#                        sline.setData(f1,tot[-1],connect=&#39;all&#39;)</span>
<span class="c1">#                        fplot.setTitle(&#39;Q=%.6f&#39;%self.data[self.fnames[0]][&#39;xintp&#39;][i])</span>
<span class="c1">#                    except:</span>
<span class="c1">#                        fplot=pg.plot(labels={&#39;left&#39;:&#39;Intensity&#39;,&#39;bottom&#39;:self.elements[Np-1]+&#39;_f1&#39;})</span>
<span class="c1">#                        sdata=pg.PlotDataItem(f1,self.BMatrix[:,i],pen=None,symbol=&#39;o&#39;)</span>
<span class="c1">#                        sline=pg.PlotDataItem(f1,tot[-1],connect=&#39;all&#39;)</span>
<span class="c1">#                        fplot.addItem(sdata)</span>
<span class="c1">#                        fplot.addItem(sline)</span>
<span class="c1">#                        fplot.setTitle(&#39;Q=%.6f&#39;%self.data[self.fnames[0]][&#39;xintp&#39;][i])   </span>
                    <span class="n">ans</span><span class="o">=</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">question</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;Question&#39;</span><span class="p">,</span><span class="s1">&#39;Do you like to see the next Q?&#39;</span><span class="p">,</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Yes</span><span class="p">,</span> <span class="n">QMessageBox</span><span class="o">.</span><span class="n">No</span><span class="p">)</span>                         
                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">AIndex</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">AIndex</span><span class="p">[</span><span class="n">key</span><span class="p">]])</span> 
                    <span class="k">except</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="n">X</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">AIndex</span><span class="p">[</span><span class="n">key</span><span class="p">]]]</span>
            <span class="c1">#try:</span>
            <span class="c1">#    fplot.close()</span>
            <span class="c1">#except:</span>
            <span class="c1">#    pass</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Np</span><span class="p">):</span>
                <span class="n">key</span><span class="o">=</span><span class="s1">&#39;S_</span><span class="si">%s</span><span class="s1">-</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">directComponentPlotWidget</span><span class="o">.</span><span class="n">add_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qintp</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="n">key</span><span class="p">],</span><span class="n">name</span><span class="o">=</span><span class="n">key</span><span class="p">)</span>
            <span class="n">tot</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tot</span><span class="p">)</span>
            <span class="c1">#print(len(self.qintp),tot.shape)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">directComponentPlotWidget</span><span class="o">.</span><span class="n">add_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qintp</span><span class="p">,</span><span class="n">tot</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Total&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">directComponentListWidget</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="s1">&#39;Total&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">directComponentPlotWidget</span><span class="o">.</span><span class="n">add_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qintp</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fnames</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;yintp&#39;</span><span class="p">],</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;data_</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">datanames</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">directComponentListWidget</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="s1">&#39;data_</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">datanames</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Np</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">Np</span><span class="p">):</span>
                    <span class="n">key</span><span class="o">=</span><span class="s1">&#39;S_</span><span class="si">%s</span><span class="s1">-</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">crossComponentPlotWidget</span><span class="o">.</span><span class="n">add_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qintp</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="n">key</span><span class="p">],</span><span class="n">name</span><span class="o">=</span><span class="n">key</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_ASAXSPlot</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">directComponentListWidget</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">setSelected</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">crossComponentListWidget</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">setSelected</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">saveASAXSPushButton</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">QMessageBox</span><span class="o">.</span><span class="n">information</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s2">&quot;ASAXS Error&quot;</span><span class="p">,</span><span class="s2">&quot;Please select three or more data sets to get ASAXS components&quot;</span><span class="p">,</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span></div>
        
        
    <span class="k">def</span> <span class="nf">directComponentSelectionChanged</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">items</span><span class="o">=</span><span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">()</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">directComponentListWidget</span><span class="o">.</span><span class="n">selectedItems</span><span class="p">()]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">directComponentPlotWidget</span><span class="o">.</span><span class="n">Plot</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_ASAXSPlot</span><span class="p">()</span>
        
    <span class="k">def</span> <span class="nf">crossComponentSelectionChanged</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">items</span><span class="o">=</span><span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">()</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">crossComponentListWidget</span><span class="o">.</span><span class="n">selectedItems</span><span class="p">()]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">crossComponentPlotWidget</span><span class="o">.</span><span class="n">Plot</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_ASAXSPlot</span><span class="p">()</span>
            
<div class="viewcode-block" id="ASAXS_Widget.raiseDock"><a class="viewcode-back" href="../SAXS_Drive_link.html#ASAXS_widget.ASAXS_Widget.raiseDock">[docs]</a>    <span class="k">def</span> <span class="nf">raiseDock</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">dock</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Raises the dock as the topmost</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">stack</span><span class="o">=</span><span class="n">dock</span><span class="o">.</span><span class="n">container</span><span class="p">()</span><span class="o">.</span><span class="n">stack</span>
        <span class="n">current</span><span class="o">=</span><span class="n">stack</span><span class="o">.</span><span class="n">currentWidget</span><span class="p">()</span>
        <span class="n">current</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">setDim</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">stack</span><span class="o">.</span><span class="n">setCurrentWidget</span><span class="p">(</span><span class="n">dock</span><span class="p">)</span>
        <span class="n">dock</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">setDim</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span></div>
            
        
<div class="viewcode-block" id="ASAXS_Widget.update_ASAXSPlot"><a class="viewcode-back" href="../SAXS_Drive_link.html#ASAXS_widget.ASAXS_Widget.update_ASAXSPlot">[docs]</a>    <span class="k">def</span> <span class="nf">update_ASAXSPlot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Updates the ASAXS plot</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#datanames=[item.text().split(&#39;: &#39;)[0] for item in self.dataListWidget.selectedItems()] </span>
        <span class="c1">#if np.all(self.XMatrix[:,1]&gt;0):</span>
        <span class="c1">#self.ASAXSPlotWidget.Plot([&#39;Total&#39;,&#39;SAXS-term&#39;,&#39;Cross-term&#39;,&#39;Resonant-term&#39;])</span>
        <span class="c1">#else:</span>
        <span class="c1">#    self.ASAXSPlotWidget.Plot([&#39;Total&#39;,&#39;SAXS-term&#39;,&#39;neg Cross-term&#39;,&#39;Resonant-term&#39;])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">raiseDock</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ASAXSPlotDock</span><span class="p">)</span></div>
        <span class="c1">#self.mainDock.moveDock(self.ASAXSPlotDock,&#39;above&#39;,self.dataPlotDock)</span>
        
<div class="viewcode-block" id="ASAXS_Widget.check_components"><a class="viewcode-back" href="../SAXS_Drive_link.html#ASAXS_widget.ASAXS_Widget.check_components">[docs]</a>    <span class="k">def</span> <span class="nf">check_components</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks the scattering components</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">pg</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qintp</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">XMatrix</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">XMatrix</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">XMatrix</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span><span class="n">line</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">symbol</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">QMessageBox</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;Components not found&#39;</span><span class="p">,</span><span class="s1">&#39;Please split into the components first&#39;</span><span class="p">,</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">)</span></div>
        
        
    <span class="k">def</span> <span class="nf">save_ASAXS</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">fname</span><span class="o">=</span><span class="n">QFileDialog</span><span class="o">.</span><span class="n">getSaveFileName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">caption</span><span class="o">=</span><span class="s1">&#39;Save as&#39;</span><span class="p">,</span><span class="n">directory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dataDir</span><span class="p">,</span><span class="nb">filter</span><span class="o">=</span><span class="s1">&#39;Text files (*.txt)&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">fname</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="n">fname</span><span class="o">=</span><span class="n">fname</span><span class="o">+</span><span class="s1">&#39;.txt&#39;</span>
        <span class="c1">#fh=open(fname,&#39;w&#39;)</span>
        <span class="n">header</span><span class="o">=</span><span class="s1">&#39;Scattering components extracted on &#39;</span><span class="o">+</span><span class="n">time</span><span class="o">.</span><span class="n">asctime</span><span class="p">()</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">header</span><span class="o">=</span><span class="n">header</span><span class="o">+</span><span class="s1">&#39;Data files used for the the scattering components calculations are:</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fnames</span><span class="p">:</span>
            <span class="n">header</span><span class="o">=</span><span class="n">header</span><span class="o">+</span><span class="n">file</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">header</span><span class="o">=</span><span class="n">header</span><span class="o">+</span><span class="s1">&#39;col_names=&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">([</span><span class="s1">&#39;Q(inv Angs)&#39;</span><span class="p">]</span><span class="o">+</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">header</span><span class="o">=</span><span class="n">header</span><span class="o">+</span><span class="s1">&#39;Q(inv Angs)</span><span class="se">\t</span><span class="s1">&#39;</span>
        <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">qintp</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">header</span><span class="o">=</span><span class="n">header</span><span class="o">+</span><span class="n">key</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span>
            <span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">data</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="n">key</span><span class="p">]))</span>
        <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span><span class="n">data</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="n">header</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">open_ASAXS</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">fname</span><span class="o">=</span><span class="n">QFileDialog</span><span class="o">.</span><span class="n">getOpenFileName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">caption</span><span class="o">=</span><span class="s1">&#39;Save as&#39;</span><span class="p">,</span><span class="n">directory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dataDir</span><span class="p">,</span><span class="nb">filter</span><span class="o">=</span><span class="s1">&#39;Text files (*.txt)&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">fh</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">=</span><span class="n">fh</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="n">data</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;#&#39;</span><span class="p">:</span>
                <span class="n">comment</span><span class="o">=</span><span class="n">line</span>
            <span class="k">else</span><span class="p">:</span>
               <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">())))</span>
        <span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">keys</span><span class="o">=</span><span class="n">comment</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">components</span><span class="o">==</span><span class="p">{}</span>
        <span class="n">i</span><span class="o">=</span><span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qintp</span><span class="o">=</span><span class="n">data</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">comoponents</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="n">data</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span>
            <span class="n">i</span><span class="o">+=</span><span class="mi">1</span></div>
        
        
        
        
        
<span class="k">if</span> <span class="vm">__name__</span><span class="o">==</span><span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">app</span><span class="o">=</span><span class="n">QApplication</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>
    <span class="n">w</span><span class="o">=</span><span class="n">ASAXS_Widget</span><span class="p">()</span>
    <span class="n">w</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s1">&#39;ASAXS Widget&#39;</span><span class="p">)</span>
    <span class="n">w</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">1000</span><span class="p">,</span><span class="mi">800</span><span class="p">)</span>
    
    <span class="n">w</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">exec_</span><span class="p">())</span>
        
        
        
    
</pre></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="nav-item nav-item-0"><a href="../index.html">SAXS_Drive 0.11 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2017, Mrinal Kanti Bera@NSF&#39;s ChemMatCARS.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.2.
    </div>
  </body>
</html>